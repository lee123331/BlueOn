<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlueOn | 전문가 등록 – 전문가 소개</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#0056ff;
  --bg:#ffffff;
  --white:#ffffff;
  --text-dark:#111827;
  --text-gray:#6b7280;
  --line:#e5e7eb;
}

*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:"Noto Sans KR",sans-serif;
  background:var(--bg);
  color:var(--text-dark);
}

.wrapper{
  max-width:1400px;
  margin:0 auto;
  padding:40px 30px;
  display:flex;
  gap:40px;
}

/* ASIDE */
aside{
  width:260px;
  border:1px solid var(--line);
  padding:25px 20px;
  border-radius:12px;
}
.aside-title{
  font-size:18px;
  font-weight:700;
  margin-bottom:20px;
  color:var(--primary);
}
.menu-item{
  padding:12px;
  border-radius:8px;
  margin-bottom:8px;
  cursor:pointer;
}
.menu-item:hover{background:#eef3ff;}
.menu-item.active{
  background:var(--primary);
  color:#fff;
}

/* CONTENT */
section.content{
  flex:1;
  border:1px solid var(--line);
  border-radius:12px;
  padding:40px 50px 80px;
}

h2{font-size:24px;font-weight:800;margin-bottom:30px;}

/* PROFILE */
.profile-row{
  display:flex;
  gap:40px;
  margin-bottom:26px;
}
.profile-avatar{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
}
.profile-avatar img{
  width:110px;height:110px;border-radius:50%;
}
.profile-btn{
  padding:7px 14px;
  border-radius:7px;
  background:#f3f4f6;
  border:1px solid var(--line);
  cursor:pointer;
}

/* NICKNAME */
.nickname-row{display:flex;gap:28px;flex:1;}
.nickname-input-box{flex:1;margin-top:30px;}
.nickname-input-box input{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid var(--line);
  background:#f5f5f5;
}
.status-msg{font-size:12px;margin-top:5px;}
.status-msg.ok{color:#16a34a;}
.status-msg.error{color:#ef4444;}

/* CATEGORY */
.category-wrapper{display:flex;gap:20px;}
.category-left{
  width:260px;
  border:1px solid var(--line);
  height:350px;
  overflow:auto;
}
.category-right{
  flex:1;
  border:1px solid var(--line);
  height:350px;
  padding:18px;
}
.category-left-item,.subcat-item{
  padding:12px;
  cursor:pointer;
}
.category-left-item.active,
.subcat-item.active{
  background:var(--primary);
  color:#fff;
}

/* BUTTON */
.next-button{
  margin-top:35px;
  padding:14px 36px;
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="wrapper">

  <aside>
    <div class="aside-title">전문가 등록</div>
    <div class="menu-item active" onclick="goStep('intro')">전문가 소개</div>
    <div class="menu-item" onclick="goStep('career')">경력 사항</div>
    <div class="menu-item" onclick="goStep('skill')">전문 역량 & 인증</div>
    <div class="menu-item" onclick="goStep('brand')">브랜드 스토리</div>
  </aside>

  <section class="content">
    <h2>전문가 소개</h2>

    <div class="profile-row">
      <div class="profile-avatar">
        <img id="expertPreview" src="/assets/default_profile.png">
        <input type="file" id="expertAvatar" hidden>
        <button class="profile-btn" onclick="expertAvatar.click()">프로필 변경</button>
      </div>

      <div class="nickname-row">
        <div class="nickname-input-box">
          <input id="nicknameInput" placeholder="닉네임 입력">
          <small id="nicknameStatus" class="status-msg"></small>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label>상세 자기소개</label>
      <textarea id="introDetail" rows="7"></textarea>
    </div>

    <div class="form-group">
      <label>서비스 카테고리</label>
      <div class="category-wrapper">
        <div id="topCategoryBox" class="category-left"></div>
        <div id="subCategoryBox" class="category-right"></div>
      </div>
    </div>

    <button class="next-button" onclick="goNextStep()">다음 단계로 이동</button>
  </section>
</div>

<script>
const API_URL = "https://blueon.up.railway.app";

const nicknameInput = document.getElementById("nicknameInput");
const nicknameStatus = document.getElementById("nicknameStatus");
const introDetail = document.getElementById("introDetail");
const avatarInput = document.getElementById("expertAvatar");
const avatarPreview = document.getElementById("expertPreview");
const topBox = document.getElementById("topCategoryBox");
const subBox = document.getElementById("subCategoryBox");

const categoryMap = {
  shop:["쇼핑몰 구축","쇼핑몰 리뉴얼"],
  brand:["로고 디자인","브랜드 스토리"],
  ux:["UX 개선","전환율 분석"]
};
const titles = {
  shop:"쇼핑몰",
  brand:"브랜드",
  ux:"UX/UI"
};

let selectedTop="", selectedSub="";

/* 저장 */
function saveStep1(){
  localStorage.setItem("expert_step1",JSON.stringify({
    nickname:nicknameInput.value,
    intro:introDetail.value,
    top:selectedTop,
    sub:selectedSub,
    avatar:avatarPreview.dataset.url||""
  }));
}

/* 불러오기 */
function loadStep1(){
  const saved=localStorage.getItem("expert_step1");
  if(!saved) return;
  const d=JSON.parse(saved);
  nicknameInput.value=d.nickname||"";
  introDetail.value=d.intro||"";
  selectedTop=d.top||"";
  selectedSub=d.sub||"";
  if(d.avatar){
    avatarPreview.src=d.avatar;
    avatarPreview.dataset.url=d.avatar;
  }
}

/* 카테고리 */
function renderTop(){
  topBox.innerHTML="";
  Object.keys(titles).forEach(k=>{
    const div=document.createElement("div");
    div.textContent=titles[k];
    div.className="category-left-item"+(k===selectedTop?" active":"");
    div.onclick=()=>{selectedTop=k;selectedSub="";renderTop();renderSub();saveStep1();}
    topBox.appendChild(div);
  });
}
function renderSub(){
  subBox.innerHTML="";
  if(!selectedTop) return;
  categoryMap[selectedTop].forEach(n=>{
    const div=document.createElement("div");
    div.textContent=n;
    div.className="subcat-item"+(n===selectedSub?" active":"");
    div.onclick=()=>{selectedSub=n;renderSub();saveStep1();}
    subBox.appendChild(div);
  });
}

/* 닉네임 체크 */
nicknameInput.addEventListener("blur",async()=>{
  if(!nicknameInput.value) return;
  const res=await fetch(`${API_URL}/expert/check-nickname?nickname=${encodeURIComponent(nicknameInput.value)}`);
  const d=await res.json();
  nicknameStatus.textContent=d.exists?"이미 사용 중":"사용 가능";
  nicknameStatus.className="status-msg "+(d.exists?"error":"ok");
  saveStep1();
});

/* 이동 */
function goNextStep(){
  if(!nicknameInput.value||!selectedTop||!selectedSub){
    alert("필수 항목을 입력하세요");
    return;
  }
  location.href="/expert-register-step2.html";
}
function goStep(step){
  const map={
    intro:"/expert-register-step1.html",
    career:"/expert-register-step2.html",
    skill:"/expert-register-step3.html",
    brand:"/expert-register-step4.html"
  };
  location.href=map[step];
}

/* INIT */
window.addEventListener("DOMContentLoaded",()=>{
  loadStep1();
  renderTop();
  renderSub();
});
</script>

</body>
</html>
