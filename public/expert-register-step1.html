<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlueOn | ì „ë¬¸ê°€ ë“±ë¡ â€“ ì „ë¬¸ê°€ ì†Œê°œ</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#0056ff;

  --bg:#ffffff;
  --white:#ffffff;

  --text-dark:#111827;
  --text-gray:#6b7280;
  --line:#e5e7eb;
}

*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family:"Noto Sans KR",sans-serif;
  background:var(--bg);
  color:var(--text-dark);
}

/* ì „ì²´ ë ˆì´ì•„ì›ƒ */
.wrapper{
  background: var(--white);
  max-width:1400px;
  margin:0 auto;
  padding:40px 30px;
  display:flex;
  gap:40px;
}

/* ========== ASIDE ========== */
aside{
  width:260px;
  background:var(--white);
  border:1px solid var(--line);
  padding:25px 20px;
  border-radius:12px;
  box-shadow:0 5px 18px rgba(0,0,0,0.04);
}

.aside-title{
  font-size:18px;
  font-weight:700;
  margin-bottom:20px;
  color:var(--primary);
}

.menu-item{
  padding:12px 12px;
  border-radius:8px;
  margin-bottom:8px;
  font-size:15px;
  cursor:pointer;
  transition:0.2s;
}

.menu-item:hover{
  background:#eef3ff;
}

.menu-item.active{
  background:var(--primary);
  color:#fff;
  font-weight:600;
}

/* ========== CONTENT ========== */
section.content{
  flex:1;
  background:var(--white);
  border:1px solid var(--line);
  border-radius:12px;
  padding:40px 50px 80px; /* ì•„ë˜ìª½ ì—¬ë°± ë„‰ë„‰í•˜ê²Œ */
  box-shadow:0 6px 18px rgba(0,0,0,0.04);
}

section h2{
  font-size:24px;
  font-weight:800;
  margin-bottom:30px;
}

/* í”„ë¡œí•„ + ë‹‰ë„¤ì„ UI */
.profile-row{
  display:flex;
  align-items:flex-start;
  gap:40px;
  margin-bottom:26px;
}

.profile-avatar{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
}

.profile-avatar img{
  width:110px;
  height:110px;
  border-radius:50%;
  object-fit:cover;
  border:3px solid #e5e5e5;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.profile-btn{
  padding:7px 14px;
  border-radius:7px;
  background:#f3f4f6;
  border:1px solid var(--line);
  cursor:pointer;
  font-size:13px;
  font-weight:600;
}
.profile-btn:hover{
  background:#e9efff;
  border-color:#c7d6ff;
}

/* ë‹‰ë„¤ì„ ë¼ì¸ */
.nickname-row{
  display:flex;
  align-items:center;
  gap:28px;
  flex:1;
}

/* ì™¼ìª½ ë¼ë²¨ */
.nickname-label{
  width:80px;
  font-size:15px;
  font-weight:700;
}

/* ì…ë ¥ ì˜ì—­ */
.nickname-input-box{
  flex:1;
  display:flex;
  flex-direction:column;
  margin-top:30px;
}

/* ë‹‰ë„¤ì„ ì…ë ¥ë€ íšŒìƒ‰ ë°°ê²½ */
.nickname-input-box input{
  width:100%;
  padding:12px 14px;
  border-radius:8px;
  border:1px solid var(--line);
  font-size:15px;
  background:#f5f5f5;
  outline:none;
}

/* placeholder ì§„í•˜ê²Œ */
#nicknameInput::placeholder{
  color:#6b7280;
  font-weight:600;
}

/* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ë§Œ íŒŒë€ìƒ‰ */
.nickname-input-box input:focus{
  border-color:var(--primary);
  background:#e4e2e2;
}

/* ìƒíƒœ ë©”ì‹œì§€ */
.status-msg{
  margin-top:5px;
  font-size:12px;
  min-height:14px;
}
.status-msg.ok{color:#16a34a;}
.status-msg.error{color:#ef4444;}

/* TIP */
.tip-box{
  background:#f5f7ff;
  border:1px solid #dbeafe;
  padding:16px 18px;
  border-radius:10px;
  font-size:13px;
  color:var(--text-gray);
  margin-bottom:26px;
}
.tip-box li{
  margin-left:18px;
  list-style:square;
}

/* í¼ ê³µí†µ */
.form-group{
  position:static;
  overflow:visible;
  margin-bottom:25px;
}
.form-group label{
  font-weight:700;
  margin-bottom:8px;
  display:block;
}

/* ìƒì„¸ ìê¸°ì†Œê°œ íšŒìƒ‰ ë°°ê²½ */
#introDetail{
  width:100%;
  padding:14px;
  border:1px solid var(--line);
  border-radius:8px;
  font-size:15px;
  background:#f5f5f5;
  outline:none;
}
#introDetail:focus{
  border-color:var(--primary);
}

/* ================================
   2ë‹¨ ì¹´í…Œê³ ë¦¬ ì„ íƒ UI
================================ */
.category-wrapper {
  display: flex;
  width: 100%;
  gap: 20px;
  align-items: stretch;
}


.category-left {
  width: 260px;
  border: 1px solid var(--line);
  border-radius: 10px;
  background: #fafafa;
  overflow-y: auto;
  height: 350px; /* í†µì¼ */
}


.category-left-item {
  padding: 14px 16px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  transition: 0.15s;
  font-size: 15px;
  font-weight: 500;
}

.category-left-item:hover {
  background: #eef3ff;
}

.category-left-item.active {
  background: var(--primary);
  color: #fff;
  font-weight: 700;
}

.category-right {
  flex: 1;
  border: 1px solid var(--line);
  border-radius: 10px;
  background: #fff;
  padding: 18px 20px;
  overflow-y: auto;
  height: 350px; /* í†µì¼ */
}

.subcat-item {
  padding: 12px 14px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  margin-bottom: 10px;
  cursor: pointer;
  transition: 0.2s;
}

.subcat-item:hover {
  background: #f5f7ff;
  border-color: #c7d6ff;
}

.subcat-item.active {
  background: var(--primary);
  border-color: var(--primary);
  color: #fff;
  font-weight: 700;
}


/* ë²„íŠ¼ */
.next-button{
  margin-top:35px;
  padding:14px 36px;
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:10px;
  font-weight:700;
  font-size:16px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.next-button:hover{
  background:#0044cc;
}
</style>
</head>

<body>

<div class="wrapper">

  <!-- ASIDE -->
  <aside>
    <div class="aside-title">ì „ë¬¸ê°€ ë“±ë¡</div>

    <div class="menu-item active" onclick="goStep('intro')">ì „ë¬¸ê°€ ì†Œê°œ</div>
    <div class="menu-item" onclick="goStep('career')">ê²½ë ¥ ì‚¬í•­</div>
    <div class="menu-item" onclick="goStep('skill')">ì „ë¬¸ ì—­ëŸ‰ & ì¸ì¦</div>
    <div class="menu-item" onclick="goStep('brand')">ë¸Œëœë“œ ìŠ¤í† ë¦¬</div>
  </aside>

  <!-- CONTENT -->
  <section class="content">

    <h2>ì „ë¬¸ê°€ ì†Œê°œ</h2>

    <!-- í”„ë¡œí•„ + ë‹‰ë„¤ì„ -->
    <div class="profile-row">

      <div class="profile-avatar">
        <img id="expertPreview" src="/assets/default_profile.png" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
        <input type="file" id="expertAvatar" accept="image/*" hidden>
        <button type="button" class="profile-btn" onclick="document.getElementById('expertAvatar').click()">í”„ë¡œí•„ ë³€ê²½</button>
      </div>

      <div class="nickname-row">
        <label for="nicknameInput" class="nickname-label">ë‹‰ë„¤ì„</label>
        <div class="nickname-input-box">
          <input id="nicknameInput" type="text" placeholder="ë‹‰ë„¤ì„ ì…ë ¥">
          <small id="nicknameStatus" class="status-msg"></small>
        </div>
      </div>

    </div>

    <!-- TIP -->
    <div class="tip-box">
      <ul>
        <li>ë‹‰ë„¤ì„ì€ ìµœì´ˆ 1íšŒë§Œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        <li>íŠ¹ìˆ˜ë¬¸ì, ê³µë°±, ê³¼ë„í•œ ê´‘ê³ ì„± ë¬¸êµ¬ëŠ” ì‚¬ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        <li>í•œê¸€/ì˜ë¬¸/ìˆ«ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë©”ì¼ ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì™€ ë™ì¼í•œ ë¬¸ìì—´ì€ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      </ul>
    </div>

    <!-- ìƒì„¸ ì†Œê°œ -->
    <div class="form-group">
      <label for="introDetail">ìƒì„¸ ìê¸°ì†Œê°œ</label>
      <textarea id="introDetail" rows="7" placeholder="ì „ë¬¸ê°€ë‹˜ì˜ ê²½í—˜, ì‘ì—… ìŠ¤íƒ€ì¼, ê³ ê°ê³¼ì˜ í˜‘ì—… ë°©ì‹ ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
    </div>
<!-- 2ë‹¨ ì¹´í…Œê³ ë¦¬ UI -->
<div class="form-group">
  <label>ì„œë¹„ìŠ¤ ì¹´í…Œê³ ë¦¬</label>

  <div class="category-wrapper">
    
    <!-- ì™¼ìª½: ìƒìœ„ ì¹´í…Œê³ ë¦¬ -->
    <div id="topCategoryBox" class="category-left"></div>

    <!-- ì˜¤ë¥¸ìª½: í•˜ìœ„ ì¹´í…Œê³ ë¦¬ -->
    <div id="subCategoryBox" class="category-right">
      <p style="color:var(--text-gray);">ìƒìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</p>
    </div>

  </div>
</div>


    <button class="next-button" type="button" onclick="goNextStep()">
  ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
</button>

  </section>

</div>
<script>
const API_URL = "https://blueon.up.railway.app";

/* ===============================
   DOM ìš”ì†Œ
================================ */
const nicknameInput = document.getElementById("nicknameInput");
const nicknameStatus = document.getElementById("nicknameStatus");
const introDetail = document.getElementById("introDetail");
const avatarInput = document.getElementById("expertAvatar");
const avatarPreview = document.getElementById("expertPreview");

const topBox = document.getElementById("topCategoryBox");
const subBox = document.getElementById("subCategoryBox");

/* ===============================
   ì¹´í…Œê³ ë¦¬ ë°ì´í„° (ì „ë¬¸ê°€ Step1 ìµœì¢…)
================================ */

const categoryMap = {
  shop: [
    "ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ Â· ë§ˆì¼“ êµ¬ì¶•",
    "ìì‚¬ëª° êµ¬ì¶•",
    "ëœë”©í˜ì´ì§€ ì œì‘",
    "í™ˆí˜ì´ì§€ ì œì‘",
    "ì‡¼í•‘ëª° UI/UX ê°œì„ ",
    "ì‡¼í•‘ëª° ê¸°ëŠ¥ ì»¤ìŠ¤í„°ë§ˆì´ì§•"
  ],

  detail: [
    "ìƒì„¸í˜ì´ì§€ ë””ìì¸",
    "ìƒì„¸í˜ì´ì§€ ê¸°íš",
    "ë°°ë„ˆ Â· ê´‘ê³  ì´ë¯¸ì§€ ë””ìì¸",
    "SNS ì½˜í…ì¸  ë””ìì¸",
    "ì œí’ˆ ì´¬ì˜ ì—°ê³„"
  ],

  brand: [
    "ë¡œê³  ë””ìì¸",
    "ë¸Œëœë“œ ì•„ì´ë´í‹°í‹°(BIÂ·CI)",
    "ë¸Œëœë“œ í‚¤ë¹„ì£¼ì–¼ ë””ìì¸",
    "ë¸Œëœë“œ ìŠ¤í† ë¦¬í…”ë§",
    "ë¸Œëœë“œ ê°€ì´ë“œ ì œì‘"
  ],

  ux: [
    "UX êµ¬ì¡° ì„¤ê³„",
    "ì „í™˜ìœ¨(CRO) ê°œì„ ",
    "ê³ ê° ì—¬ì • ì§€ë„(CJM)",
    "ì‚¬ìš©ì ê²½í—˜ ë¶„ì„",
    "UI ê°œì„  Â· ë¦¬ë””ìì¸"
  ]
};

const topCategoryTitles = {
  shop: "ì‡¼í•‘ëª° Â· ì›¹ ì œì‘",
  detail: "ì½˜í…ì¸  Â· ìƒì„¸í˜ì´ì§€ ë””ìì¸",
  brand: "ë¸Œëœë“œ ë””ìì¸",
  ux: "ì „í™˜ìœ¨ ê°œì„  Â· UX/UI"
};


let selectedTop = "";
let selectedSub = "";

/* ===============================
   STEP1 ì €ì¥ (ë¡œì»¬ + ì„œë²„)
================================ */
async function saveStep1({ syncServer = false } = {}) {
  const data = {
    nickname: nicknameInput.value || "",
    intro: introDetail.value || "",
    topCategory: selectedTop || "",
    subCategory: selectedSub || "",
    avatarUrl: avatarPreview.dataset.url || ""
  };

  // âœ… ë¡œì»¬ ì €ì¥
  localStorage.setItem("expert_step1", JSON.stringify(data));

  // âœ… í•„ìš”í•  ë•Œë§Œ ì„œë²„ ì €ì¥
  if (syncServer) {
    try {
      await fetch(`${API_URL}/expert/save-step`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ step: 1, data })
      });
    } catch (e) {
      console.warn("ì„œë²„ ì €ì¥ ì‹¤íŒ¨", e);
    }
  }
}

/* ===============================
   STEP1 ë¶ˆëŸ¬ì˜¤ê¸°
================================ */
function loadStep1() {
  const saved = localStorage.getItem("expert_step1");
  if (!saved) return;

  try {
    const data = JSON.parse(saved);
    nicknameInput.value = data.nickname || "";
    introDetail.value = data.intro || "";
    selectedTop = data.topCategory || "";
    selectedSub = data.subCategory || "";

    if (data.avatarUrl) {
      avatarPreview.src = data.avatarUrl;
      avatarPreview.dataset.url = data.avatarUrl;
    }
  } catch {}
}

/* ===============================
   ì¹´í…Œê³ ë¦¬ ë Œë”ë§
================================ */
function renderTopCategories() {
  topBox.innerHTML = "";

  Object.keys(topCategoryTitles).forEach(key => {
    const div = document.createElement("div");
    div.className = "category-left-item";
    div.textContent = topCategoryTitles[key];
    if (selectedTop === key) div.classList.add("active");

    div.onclick = () => {
      selectedTop = key;
      selectedSub = "";
      renderTopCategories();
      renderSubCategories();
      saveStep1();
    };

    topBox.appendChild(div);
  });
}

function renderSubCategories() {
  subBox.innerHTML = "";

  if (!selectedTop) {
    subBox.innerHTML =
      "<p style='color:#6b7280;'>ìƒìœ„ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>";
    return;
  }

  categoryMap[selectedTop].forEach(name => {
    const div = document.createElement("div");
    div.className = "subcat-item";
    div.textContent = name;
    if (selectedSub === name) div.classList.add("active");

    div.onclick = () => {
      selectedSub = name;
      renderSubCategories();
      saveStep1();
    };

    subBox.appendChild(div);
  });
}

/* ===============================
   ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ (ìµœì¢… ì•ˆì •í™”)
   - server: available true/false ê¸°ì¤€
   - debounce 400ms
   - input ì´ë²¤íŠ¸ ê¸°ë°˜
================================ */

let nicknameValid = false;
let nicknameTimer = null;

nicknameInput.addEventListener("input", () => {
  const nickname = nicknameInput.value.trim();

  // ì´ˆê¸°í™”
  nicknameStatus.className = "status-msg";
  nicknameStatus.textContent = "";
  nicknameValid = false;

  // ë¹ˆ ê°’ì´ë©´ ê²€ì‚¬ ì•ˆ í•¨
  if (!nickname) return;

  // ì´ì „ íƒ€ì´ë¨¸ ì œê±°
  clearTimeout(nicknameTimer);

  // 400ms ì…ë ¥ ë©ˆì¶”ë©´ ê²€ì‚¬
  nicknameTimer = setTimeout(async () => {
    try {
      const res = await fetch(
        `${API_URL}/expert/check-nickname?nickname=${encodeURIComponent(nickname)}`,
        { credentials: "include" }
      );

      if (!res.ok) throw new Error("request failed");

      const data = await res.json();

      // âœ… ì„œë²„ëŠ” available ê¸°ì¤€
      if (!data.available) {
        nicknameStatus.textContent = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.";
        nicknameStatus.classList.add("error");
        nicknameValid = false;
      } else {
        nicknameStatus.textContent = "ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.";
        nicknameStatus.classList.add("ok");
        nicknameValid = true;
      }

    } catch (err) {
      console.error("ë‹‰ë„¤ì„ ì²´í¬ ì˜¤ë¥˜:", err);
      nicknameStatus.textContent = "ë‹‰ë„¤ì„ í™•ì¸ ì‹¤íŒ¨";
      nicknameStatus.classList.add("error");
      nicknameValid = false;
    }
  }, 400);
});

/* ===============================
   ì•„ë°”íƒ€ ì—…ë¡œë“œ
================================ */
avatarInput.addEventListener("change", async () => {
  const file = avatarInput.files[0];
  if (!file) return;

  const formData = new FormData();
  formData.append("avatar", file);

  try {
    const res = await fetch(`${API_URL}/expert/upload-avatar`, {
      method: "POST",
      credentials: "include",
      body: formData
    });
    const data = await res.json();

    if (data.success) {
      avatarPreview.src = data.url;
      avatarPreview.dataset.url = data.url;
      saveStep1();
    }
  } catch {
    alert("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨");
  }
});

/* ===============================
   ì…ë ¥ ìë™ ì €ì¥ (ë¡œì»¬ë§Œ)
================================ */
nicknameInput.addEventListener("input", () => saveStep1());
introDetail.addEventListener("input", () => saveStep1());

/* ===============================
   ë‹¤ìŒ ë‹¨ê³„ ì´ë™
================================ */
function goNextStep() {
  const nickname = nicknameInput.value.trim();

  // 1ï¸âƒ£ ë‹‰ë„¤ì„ ì…ë ¥ ì—¬ë¶€
  if (!nickname) {
    alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  // 2ï¸âƒ£ ë‹‰ë„¤ì„ ì¤‘ë³µ ê²€ì‚¬ í†µê³¼ ì—¬ë¶€ (ğŸ”¥ í•µì‹¬)
  if (!nicknameValid) {
    alert("ë‹‰ë„¤ì„ ì¤‘ë³µ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
    nicknameInput.focus();
    return;
  }

  // 3ï¸âƒ£ ì¹´í…Œê³ ë¦¬ ì„ íƒ ì—¬ë¶€
  if (!selectedTop || !selectedSub) {
    alert("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    return;
  }

  // 4ï¸âƒ£ ì €ì¥ + ë‹¤ìŒ ë‹¨ê³„
  saveStep1({ syncServer: true });
  location.href = "/expert-register-step2.html";
}

/* ===============================
   ì „ë¬¸ê°€ ë“±ë¡ ë‹¨ê³„ ì´ë™
================================ */
function goStep(step) {
  const stepMap = {
    intro: "/expert-register-step1.html",
    career: "/expert-register-step2.html",
    skill: "/expert-register-step3.html",
    brand: "/expert-register-step4.html"
  };

  const target = stepMap[step];
  if (!target) return;

  // Step1 ë°ì´í„° ì €ì¥ (ë¡œì»¬)
  saveStep1();

  location.href = target;
}

/* ===============================
   ì´ˆê¸° ì‹¤í–‰
================================ */
window.addEventListener("DOMContentLoaded", () => {
  loadStep1();
  renderTopCategories();
  renderSubCategories();
});
</script>



</body>
</html>