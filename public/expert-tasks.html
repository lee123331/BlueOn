<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BlueOn | ì „ë¬¸ê°€ ì‘ì—…</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#0056ff;
  --bg:#f4f6fb;
  --white:#ffffff;
  --line:#e5e7eb;
  --text-dark:#111827;
  --text-gray:#6b7280;
}

* { box-sizing:border-box; margin:0; padding:0; }

body {
  font-family:"Noto Sans KR", sans-serif;
  background:var(--bg);
}

/* ===============================
   ìƒë‹¨ ë‹¨ê³„ í‘œì‹œ ë°”
=============================== */
.step-bar {
  background:var(--white);
  padding:20px;
  border-bottom:1px solid var(--line);
}

.step-buttons {
  max-width:1200px;
  margin:0 auto;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
}

.step-btn {
  padding:16px;
  border-radius:14px;
  border:1px solid var(--line);
  text-align:center;
  font-weight:700;
  background:#f9fafb;
  color:var(--text-gray);
}

.step-btn.active {
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
}

.step-btn span {
  display:block;
  font-size:13px;
  margin-top:6px;
  font-weight:500;
  opacity:0.9;
}

/* ===============================
   ê³µí†µ ì»¨í…Œì´ë„ˆ
=============================== */
.container {
  max-width:1200px;
  margin:30px auto;
  padding:0 20px;
}

.section-title {
  font-size:18px;
  font-weight:800;
  margin:36px 0 14px;
}

.task-list {
  background:var(--white);
  border:1px solid var(--line);
  border-radius:14px;
  overflow:hidden;
}

/* ===============================
   ì‘ì—… ì¹´ë“œ
=============================== */
.task-item {
  display:grid;
  grid-template-columns:1fr 120px 120px;
  gap:16px;
   padding: 22px 24px;   /* ê¸°ì¡´ 16px â†’ ì—¬ìœ ë§Œ ì‚´ì§ */
  min-height: 96px;     /* ì¹´ë“œ ì•ˆì •ê° */
  align-items:center;
  border-bottom:1px solid var(--line);
  cursor:pointer;
  transition:0.2s;
}

.task-item:last-child {
  border-bottom:none;
}

.task-item:hover {
  background:#f5f7ff;
}

/* ğŸ”¥ ì•Œë¦¼ìœ¼ë¡œ ë“¤ì–´ì˜¨ ì‘ì—… ê°•ì¡° */
.task-item.highlight {
  background:#eef3ff;
  border-left:6px solid var(--primary);
}

.task-left {
  display:flex;
  align-items:center;
  gap:14px;
}

.task-thumb {
  width:64px;
  height:64px;
  border-radius:10px;
  object-fit:cover;
  border:1px solid var(--line);
  background:#eef2ff;
}

.task-info {
  display:flex;
  flex-direction:column;
}

.task-title {
  font-weight:800;
  color:var(--text-dark);
  margin-bottom:4px;
}

.task-user {
  font-size:13px;
  color:var(--text-gray);
}

.task-status {
  font-size:13px;
  font-weight:700;
  color:var(--primary);
}

.task-date {
  font-size:13px;
  color:var(--text-gray);
  text-align:right;
}

.task-empty {
  padding:40px;
  text-align:center;
  color:var(--text-gray);
  font-size:14px;
}
.task-item.highlight {
  border: 2px solid #0056ff;
  background: #f3f7ff;
}
.start-btn {
  padding: 8px 14px;
  border-radius: 10px;
  border: none;
  background: var(--primary);
  color: #fff;
  font-weight: 700;
  font-size: 13px;
  cursor: pointer;
}

.start-btn:hover {
  opacity: 0.9;
}

</style>
</head>

<body>

<!-- ğŸ”¹ í˜„ì¬ ë‹¨ê³„ í‘œì‹œ -->
<div class="step-bar">
  <div class="step-buttons">
    <div class="step-btn active">
      ì‘ì—… ì‹œì‘í•˜ê¸°
      <span>ê²°ì œ ì™„ë£Œ Â· ì‘ì—… ì¤€ë¹„</span>
    </div>
    <div class="step-btn">
      ì‹œì•ˆ ì œì¶œí•˜ê¸°
      <span>1ì°¨ ê²°ê³¼ë¬¼</span>
    </div>
    <div class="step-btn">
      ì‘ì—… ìˆ˜ì •í•˜ê¸°
      <span>ìˆ˜ì • ìš”ì²­ ëŒ€ì‘</span>
    </div>
    <div class="step-btn">
      ìµœì¢… ì œì¶œ
      <span>ì‘ì—… ì™„ë£Œ</span>
    </div>
  </div>
</div>

<div class="container">

  <!-- ğŸŸ¡ ì‘ì—… ëŒ€ê¸° -->
  <div class="section-title">ì‘ì—… ëŒ€ê¸°ì¤‘ì¸ ì£¼ë¬¸</div>
  <div class="task-list" id="pendingTaskList"></div>

  <!-- ğŸ”µ ì§„í–‰ì¤‘ -->
  <div class="section-title">ì§„í–‰ì¤‘ì¸ ì‘ì—…</div>
  <div class="task-list" id="taskList"></div>

  <!-- ğŸŸ¢ ì™„ë£Œ -->
  <div class="section-title">ì™„ë£Œëœ ì‘ì—…</div>
  <div class="task-list" id="doneTaskList"></div>

</div>

<script>
const API_URL = "https://blueon.up.railway.app";

/* ===============================
   ğŸ”‘ URL íŒŒë¼ë¯¸í„°ì—ì„œ task_key ë°›ê¸°
================================ */
const params = new URLSearchParams(location.search);
const highlightTaskKey = params.get("task");

/* ===============================
   ğŸ“¦ ì‘ì—… ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
================================ */
async function loadTasks() {
  const res = await fetch(`${API_URL}/expert/tasks`, {
    credentials: "include",
  });
  const data = await res.json();

  if (!data.success) {
    alert("ì‘ì—… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  renderTasks(data.tasks || []);
}

/* ===============================
   ğŸ§© ì‘ì—… ë Œë”ë§
================================ */
function renderTasks(tasks) {
  const pending  = document.getElementById("pendingTaskList");
  const progress = document.getElementById("taskList");
  const done     = document.getElementById("doneTaskList");

  pending.innerHTML = "";
  progress.innerHTML = "";
  done.innerHTML = "";

  if (tasks.length === 0) {
    pending.innerHTML = `<div class="task-empty">ëŒ€ê¸°ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  let highlightedItem = null;

 tasks.forEach(t => {
  const buyerNickname = t.buyer_nickname || "ì˜ë¢°ì¸";
  const item = document.createElement("div");
  item.className = "task-item";
  item.dataset.taskKey = t.task_key;

  item.innerHTML = `
  <div class="task-left">
    <img class="task-thumb" src="${t.thumbnail || '/assets/default_service.png'}" />
    <div class="task-info">
      <div class="task-title">${t.service_title}</div>
      <div class="task-user">ì˜ë¢°ì¸ Â· ${buyerNickname}</div>
    </div>
  </div>

  <div class="task-status">
    ${
      t.status === "pending"
        ? `<button class="start-btn">ì‘ì—… ì‹œì‘</button>`
        : t.status
    }
  </div>

  <div class="task-date">${t.created_at?.slice(0,10)}</div>
`;



  /* ì¹´ë“œ í´ë¦­ */
  item.onclick = () => {
    location.href = `expert-task-detail.html?task=${encodeURIComponent(t.task_key)}`;
  };

  /* ìƒíƒœë³„ ë¶„ë¥˜ */
  if (t.status === "pending") pending.appendChild(item);
  else if (t.status === "done") done.appendChild(item);
  else progress.appendChild(item);
});


  /* ===============================
     ğŸ”½ ê°•ì¡°ëœ ì‘ì—… ìë™ ìŠ¤í¬ë¡¤
  ================================ */
  if (highlightedItem) {
    setTimeout(() => {
      highlightedItem.scrollIntoView({
        behavior: "smooth",
        block: "center",
      });
    }, 300);
  }
}

/* ===============================
   ğŸš€ ì´ˆê¸° ì‹¤í–‰
================================ */
loadTasks();
</script>


</body>
</html>
