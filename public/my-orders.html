<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BlueOn | ë‚´ ì‘ì—… í˜„í™©</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#0056ff;
  --bg:#f4f6fb;
  --white:#ffffff;
  --line:#e5e7eb;
  --text:#111827;
  --gray:#6b7280;
}

* { box-sizing:border-box; margin:0; padding:0; }

body {
  font-family:"Noto Sans KR", sans-serif;
  background:var(--bg);
}

header {
  background:#fff;
  border-bottom:1px solid var(--line);
  padding:16px 60px;
  font-size:22px;
  font-weight:800;
  color:var(--primary);
  cursor:pointer;
}

/* ì»¨í…Œì´ë„ˆ */
.container {
  max-width:1100px;
  margin:40px auto;
  padding:0 20px;
}

/* ìš”ì•½ ì¹´ë“œ */
.summary {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
  margin-bottom:30px;
}

.summary-card {
  background:#fff;
  border:1px solid var(--line);
  border-radius:14px;
  padding:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.summary-card b {
  font-size:20px;
}

/* ì„¹ì…˜ */
.section {
  margin-bottom:30px;
}

.section-title {
  font-size:18px;
  font-weight:800;
  margin-bottom:12px;
}

/* ì‘ì—… ì¹´ë“œ */
.task-list {
  background:#fff;
  border:1px solid var(--line);
  border-radius:16px;
  overflow:hidden;
}

.task-item {
  display:flex;
  gap:16px;
  padding:18px 22px;
  border-bottom:1px solid var(--line);
  cursor:pointer;
  align-items:center;
}

.task-item:last-child {
  border-bottom:none;
}

.task-item:hover {
  background:#f5f7ff;
}

.thumb {
  width:64px;
  height:64px;
  border-radius:10px;
  object-fit:cover;
  border:1px solid var(--line);
  background:#eef2ff;
}

.info {
  flex:1;
}

.service-title {
  font-weight:800;
  margin-bottom:6px;
}

.meta {
  font-size:14px;
  color:var(--gray);
}

.status {
  font-size:14px;
  font-weight:800;
  color:var(--primary);
  white-space:nowrap;
}
</style>
</head>

<body>

<header onclick="location.href='index.html'">BlueOn</header>

<div class="container">

  <!-- ìš”ì•½ -->
  <div class="summary">
    <div class="summary-card"><div>ì‘ì—… ì¤€ë¹„</div><b id="cntPending">0</b></div>
    <div class="summary-card"><div>ì§„í–‰ì¤‘</div><b id="cntProgress">0</b></div>
    <div class="summary-card"><div>ì‘ì—…ë¬¼ ë„ì°©</div><b id="cntArrived">0</b></div>
    <div class="summary-card"><div>ì™„ë£Œ</div><b id="cntDone">0</b></div>
  </div>

  <!-- ì‘ì—… ì¤€ë¹„ -->
  <div class="section">
    <div class="section-title">ì‘ì—… ì¤€ë¹„ì¤‘</div>
    <div class="task-list" id="pendingList"></div>
  </div>

  <!-- ì§„í–‰ì¤‘ -->
  <div class="section">
    <div class="section-title">ì§„í–‰ì¤‘</div>
    <div class="task-list" id="progressList"></div>
  </div>

  <!-- ì™„ë£Œ -->
  <div class="section">
    <div class="section-title">ì‘ì—… ì™„ë£Œ</div>
    <div class="task-list" id="doneList"></div>
  </div>

</div>

<script>
const API = "https://blueon.up.railway.app";

/* ======================================================
   ğŸ”‘ ìœ ì € ê¸°ì¤€ ìƒíƒœ ë§¤í•‘ (í•µì‹¬)
====================================================== */
function mapUserStatus(status) {
  if (status === "progress") return "progress";
  if (status === "done") return "done";
  // start, ready, pending ì „ë¶€ ì¤€ë¹„ì¤‘
  return "pending";
}

/* ======================================================
   ë‚´ ì‘ì—… ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
====================================================== */
async function loadMyTasks() {
  const res = await fetch(`${API}/my/tasks`, { credentials: "include" });
  const data = await res.json();

  if (!data.success) {
    alert("ì‘ì—… í˜„í™©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  renderTasks(data.tasks || []);
}

/* ======================================================
   ë Œë”ë§
====================================================== */
function renderTasks(tasks) {
  const pending = document.getElementById("pendingList");
  const progress = document.getElementById("progressList");
  const done = document.getElementById("doneList");

  pending.innerHTML = progress.innerHTML = done.innerHTML = "";

  let cnt = { pending:0, progress:0, done:0 };

  if (tasks.length === 0) {
    pending.innerHTML =
      `<div style="padding:24px;color:#6b7280">ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  tasks.forEach(t => {
    const userStatus = mapUserStatus(t.status);

    const div = document.createElement("div");
    div.className = "task-item";

    const statusText =
      userStatus === "pending" ? "ì‘ì—… ì¤€ë¹„ì¤‘" :
      userStatus === "progress" ? "ì§„í–‰ì¤‘" :
      "ì‘ì—… ì™„ë£Œ";

    div.innerHTML = `
      <img class="thumb" src="${t.thumbnail || '/assets/default_service.png'}">
      <div class="info">
        <div class="service-title">${t.service_title}</div>
        <div class="meta">ì „ë¬¸ê°€: ${t.expert_nickname || "ì „ë¬¸ê°€"}</div>
      </div>
      <div class="status">${statusText}</div>
    `;

    div.onclick = () => {
      location.href = `/user-task-detail.html?task=${t.task_key}`;
    };

    if (userStatus === "pending") {
      pending.appendChild(div); cnt.pending++;
    } else if (userStatus === "progress") {
      progress.appendChild(div); cnt.progress++;
    } else {
      done.appendChild(div); cnt.done++;
    }
  });

  document.getElementById("cntPending").innerText = cnt.pending;
  document.getElementById("cntProgress").innerText = cnt.progress;
  document.getElementById("cntDone").innerText = cnt.done;
}

loadMyTasks();
</script>

</body>
</html>
