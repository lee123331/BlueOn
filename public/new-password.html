<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • | BlueOn</title>
<style>
  body {
    font-family: "Noto Sans KR", sans-serif;
    max-width: 400px;
    margin: 40px auto;
    padding: 20px;
  }
  input {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    font-size: 15px;
    border: 1px solid #ddd;
    border-radius: 6px;
  }
  button {
    width: 100%;
    padding: 12px;
    margin-top: 20px;
    background: #0056ff;
    color: white;
    border: none;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
  }

  /* ğŸ”µ í† ìŠ¤íŠ¸ ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
  #toast {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    background: #0056ff;
    color: white;
    padding: 14px 22px;
    font-size: 15px;
    border-radius: 10px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s, transform 0.3s;
    z-index: 9999;
  }
  #toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(-10px);
  }
</style>
</head>
<body>

<h2>ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</h2>

<input id="pw1" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
<input id="pw2" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" />

<button onclick="updatePw()">ë³€ê²½í•˜ê¸°</button>

<!-- ğŸ”µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
<div id="toast"></div>

<script>
const params = new URLSearchParams(window.location.search);
const email = params.get("email");

/* ğŸ”µ í† ìŠ¤íŠ¸ ì•Œë¦¼ í•¨ìˆ˜ */
function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");

  setTimeout(() => {
    toast.classList.remove("show");
  }, 2500);
}

async function updatePw() {
  const pw1 = document.getElementById("pw1").value;
  const pw2 = document.getElementById("pw2").value;

  if (!pw1 || !pw2) {
    showToast("ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }
  if (pw1 !== pw2) {
    showToast("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return;
  }

  const res = await fetch("/auth/reset-password", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email,
      newPassword: pw1
    })
  });

  const data = await res.json();

  if (data.success) {
    showToast("ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!");

    setTimeout(() => {
      location.href = "/login.html";
    }, 1200);

  } else {
    showToast(data.message || "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨");
  }
}
</script>

</body>
</html>
