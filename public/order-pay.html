<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BlueOn | 내 작업 현황</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#0056ff;
  --bg:#f4f6fb;
  --white:#ffffff;
  --line:#e5e7eb;
  --text:#111827;
  --gray:#6b7280;
}

* { box-sizing:border-box; margin:0; padding:0; }

body {
  font-family:"Noto Sans KR", sans-serif;
  background:var(--bg);
}

header {
  background:#fff;
  border-bottom:1px solid var(--line);
  padding:16px 60px;
  font-size:22px;
  font-weight:800;
  color:var(--primary);
  cursor:pointer;
}

.container {
  max-width:900px;
  margin:40px auto;
  padding:0 20px;
}

.title {
  font-size:22px;
  font-weight:800;
  margin-bottom:20px;
}

.order-list {
  background:#fff;
  border:1px solid var(--line);
  border-radius:16px;
  overflow:hidden;
}

.order-item {
  display:flex;
  gap:16px;
  padding:18px 22px;
  border-bottom:1px solid var(--line);
  cursor:pointer;
}

.order-item:last-child {
  border-bottom:none;
}

.order-item:hover {
  background:#f5f7ff;
}

.thumb {
  width:64px;
  height:64px;
  border-radius:10px;
  object-fit:cover;
  border:1px solid var(--line);
  background:#eef2ff;
}

.info {
  flex:1;
}

.service-title {
  font-weight:800;
  margin-bottom:6px;
}

.meta {
  font-size:14px;
  color:var(--gray);
}

.status {
  font-size:14px;
  font-weight:700;
  color:var(--primary);
  text-align:right;
}
</style>
</head>

<body>

<header onclick="location.href='index.html'">BlueOn</header>

<div class="container">
  <div class="title">내 작업 현황</div>
  <div class="order-list" id="orderList"></div>
</div>

<script>
const API = "https://blueon.up.railway.app";

/* --------------------------------------------------
   내 주문 목록 불러오기
-------------------------------------------------- */
async function loadMyOrders() {
  const res = await fetch(`${API}/my/orders`, {
    credentials: "include"
  });
  const data = await res.json();

  if (!data.success) {
    alert("주문 목록을 불러올 수 없습니다.");
    return;
  }

  renderOrders(data.orders);
}

function renderOrders(orders) {
  const list = document.getElementById("orderList");
  list.innerHTML = "";

  if (!orders.length) {
    list.innerHTML = `<div style="padding:30px;text-align:center;color:#6b7280">
      진행 중인 작업이 없습니다.
    </div>`;
    return;
  }

  orders.forEach(o => {
    const div = document.createElement("div");
    div.className = "order-item";

    div.innerHTML = `
      <img class="thumb" src="${o.thumbnail || '/assets/default_service.png'}" />
      <div class="info">
        <div class="service-title">${o.service_title}</div>
        <div class="meta">전문가: ${o.expert_name}</div>
      </div>
      <div class="status">
        ${o.task_status || "작업 준비"}
      </div>
    `;

    div.onclick = () => {
      if (o.task_key) {
        location.href = `/user-task-detail.html?task=${o.task_key}`;
      }
    };

    list.appendChild(div);
  });
}

loadMyOrders();
</script>

</body>
</html>
