<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • | BlueOn</title>

<style>
  body {
    font-family: "Noto Sans KR", sans-serif;
    background: #f4f6fb;
    margin: 0;
    padding: 0;
  }

  .container {
    max-width: 400px;
    margin: 80px auto;
    background: white;
    padding: 30px;
    border-radius: 14px;
    box-shadow: 0px 4px 16px rgba(0,0,0,0.06);
  }

  h2 {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 20px;
    color: #111827;
    text-align: center;
  }

  p.desc {
    text-align: center;
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 25px;
  }

  input {
    width: 95%;
    padding: 14px;
    font-size: 15px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    margin-bottom: 16px;
    outline: none;
    transition: 0.2s;
    margin-left: -1%;
  }

  input:focus {
    border-color: #0056ff;
    box-shadow: 0 0 0 3px rgba(0,86,255,0.15);
  }

  button {
    width: 100%;
    padding: 14px;
    margin-top: 8px;
    background: #0056ff;
    border: none;
    color: white;
    font-size: 15px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: #003ec7;
  }

  /* ğŸ”µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
  #toast {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    background: #0056ff;
    color: white;
    padding: 14px 22px;
    font-size: 15px;
    border-radius: 10px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s, transform 0.3s;
    z-index: 9999;
  }
  #toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(-10px);
  }

  .hidden {
    display: none;
  }
</style>
</head>

<body>

<div class="container">

  <!-- ğŸ”µ STEP 1: ì´ë©”ì¼ ì…ë ¥ -->
  <div id="step1">
    <h2>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h2>
    <p class="desc">ê°€ì…í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

    <input id="emailInput" type="text" placeholder="ê°€ì… ì´ë©”ì¼ ì…ë ¥">

    <button onclick="sendCode()">ì¸ì¦ë²ˆí˜¸ ë°œì†¡</button>
  </div>

  <!-- ğŸ”µ STEP 2: ì¸ì¦ë²ˆí˜¸ ì…ë ¥ -->
  <div id="step2" class="hidden">
    <h2>ì¸ì¦ë²ˆí˜¸ í™•ì¸</h2>
    <p class="desc">ë¬¸ìë¡œ ë°›ì€ ì¸ì¦ë²ˆí˜¸ 6ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

    <input id="codeInput" type="text" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥">

    <button onclick="verifyCode()">ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™</button>
  </div>

</div>

<!-- ğŸ”µ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
<div id="toast"></div>

<script>
function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2500);
}

/* -------------------------------------------
  STEP 1: ì´ë©”ì¼ë¡œ ì¸ì¦ë²ˆí˜¸ ë°œì†¡
------------------------------------------- */
async function sendCode() {
  const email = document.getElementById("emailInput").value.trim();

  if (!email) return showToast("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

  const res = awaitfetch(`${API}/auth/send-reset-code`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({ email }),
  credentials: "include"   // ì¿ í‚¤/ì„¸ì…˜ íë¦„ ìœ ì§€ìš©
});

  const data = await res.json();

  if (data.success) {
    showToast("ì¸ì¦ë²ˆí˜¸ë¥¼ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.");
    document.getElementById("step1").classList.add("hidden");
    document.getElementById("step2").classList.remove("hidden");
  } else {
    showToast(data.message || "ì „ì†¡ ì‹¤íŒ¨");
  }
}

/* -------------------------------------------
  STEP 2: ì¸ì¦ë²ˆí˜¸ ê²€ì¦
------------------------------------------- */
async function verifyCode() {
  const email = document.getElementById("emailInput").value.trim();
  const code = document.getElementById("codeInput").value.trim();

  if (!code) return showToast("ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

  const res = await fetch(`${API}/auth/verify-reset-code`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  credentials: "include",   // ì„¸ì…˜ ê¸°ë°˜ í˜ì´ì§€ì—ì„œ ì•ˆì „í•˜ê²Œ ìœ ì§€í•˜ë ¤ë©´ ë„£ê¸°
  body: JSON.stringify({
    email,
    code
  })
});


  const data = await res.json();

  if (data.success) {
    showToast("ì¸ì¦ ì™„ë£Œ!");
    setTimeout(() => {
      location.href = `/new-password.html?email=${email}&userId=${data.userId}`;
    }, 1000);
  } else {
    showToast(data.message || "ì¸ì¦ ì‹¤íŒ¨");
  }
}
</script>

</body>
</html>
