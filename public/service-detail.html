<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì„œë¹„ìŠ¤ ìƒì„¸ | BlueOn</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary:#0056ff;
      --primary-dark:#0031b7;
      --text-dark:#111827;
      --text-gray:#6b7280;
      --line:#e5e7eb;
      --white:#ffffff;
      --bg:#f9fafb;
      --nav-active:#111827;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family:"Noto Sans KR",sans-serif;
      background:var(--bg);
      margin:0;
      color:var(--text-dark);
    }

    /* HEADER */
    header {
      background:#fff;
      border-bottom:1px solid var(--line);
      padding:16px 60px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      position:sticky;
      top:0;
      z-index:20;
    }
    header .logo {
      font-size:22px;
      font-weight:800;
      color:var(--primary);
      cursor:pointer;
    }

    /* PAGE WRAPPER */
    .wrapper {
      max-width:1200px;
      margin:30px auto 80px;
      padding:0 20px;
      display:flex;
      gap:40px;
      align-items:flex-start;
    }

    /* LEFT */
    .left-box {
      width:65%;
    }

    /* HERO */
    .hero-top {
      margin-bottom:22px;
    }
    .hero-title {
      font-size:24px;
      font-weight:800;
      margin-bottom:10px;
      line-height:1.5;
    }

    .hero-meta {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:13px;
      color:var(--text-gray);
      margin-bottom:10px;
    }

    .keyword-wrap {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:6px;
    }
    .keyword-chip {
      padding:4px 9px;
      font-size:12px;
      border-radius:999px;
      background:#f3f4ff;
      color:#374151;
    }

    /* MAIN IMAGE */
    .main-image-wrapper {
      width:100%;
      border-radius:16px;
      overflow:hidden;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 4px 18px rgba(0,0,0,0.06);
    }

    .main-image-wrapper img {
      width:100%;
      height:auto;
      object-fit:contain;
      display:block;
    }

    /* THUMBNAILS */
    .thumbnail-row {
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .thumbnail-row img {
      width:80px;
      height:80px;
      border-radius:10px;
      object-fit:cover;
      cursor:pointer;
      border:2px solid transparent;
      transition:.2s;
      background:#f3f4f6;
    }
    .thumbnail-row img.active {
      border-color:var(--primary);
    }

    /* PRICE AREA (HIDDEN) */
    .price-section {
      margin-top:26px;
      background:#fff;
      border-radius:16px;
      border:1px solid var(--line);
      padding:20px 22px;
      box-shadow:0 4px 18px rgba(0,0,0,0.03);
      display:none !important;
    }

    .price-section-title {
      font-size:18px;
      font-weight:800;
      margin-bottom:14px;
    }

    /* PKG TABS */
    .pkg-tab-row {
      display:flex;
      gap:10px;
      margin-bottom:14px;
    }
    .pkg-tab {
      flex:1;
      padding:10px 0;
      text-align:center;
      border-radius:999px;
      border:1px solid #d1d5db;
      font-size:13px;
      font-weight:700;
      color:#4b5563;
      background:#f9fafb;
      cursor:pointer;
      transition:.2s;
    }
    .pkg-tab.active {
      background:#eef3ff;
      border-color:var(--primary);
      color:var(--primary);
    }

    .price-card {
      border-radius:14px;
      border:1px solid #e5e7eb;
      padding:18px;
      background:#fbfcff;
    }

    .price-card-title {
      font-size:16px;
      font-weight:800;
      margin-bottom:4px;
    }

    .price-card-main {
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      margin-bottom:12px;
    }

    .price-card-price {
      font-size:22px;
      font-weight:800;
    }

    .price-card-meta {
      font-size:12px;
      color:#6b7280;
      text-align:right;
      line-height:1.4;
    }

    .price-card-list-title {
      font-size:13px;
      font-weight:700;
      margin-top:6px;
      margin-bottom:4px;
    }
    .price-card-list {
      font-size:13px;
      color:#374151;
      line-height:1.6;
      white-space:pre-line;
    }

    /* NAV TABS */
    .tabs-nav-wrap {
      margin-top:40px;
      background:#f3f4ff;
      border-radius:999px;
      padding:4px;
      display:inline-flex;
      gap:4px;
    }
    .tab-nav {
      padding:8px 14px;
      border-radius:999px;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      color:#4b5563;
      transition:.2s;
    }
    .tab-nav.active {
      background:#fff;
      color:var(--nav-active);
      box-shadow:0 2px 8px rgba(0,0,0,0.06);
    }

    .section-block {
      padding-top:30px;
    }

    .section-title {
      font-size:22px;
      font-weight:800;
      margin-bottom:18px;
    }

    .sub-title {
      font-size:15px;
      font-weight:700;
      margin:20px 0 8px;
    }

    .text-box {
      font-size:14px;
      color:#111827;
      line-height:1.8;
      white-space:pre-line;
    }

    /* DETAIL IMAGES */
    .detail-image {
      width:100%;
      border-radius:14px;
      margin:20px 0;
      object-fit:cover;
      display:block;
    }

    /* Q&A */
    .qa-list {
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .qa-card {
      background:#fff;
      border-radius:14px;
      border:1px solid #e5e7eb;
      padding:16px 18px;
    }
    .qa-q {
      font-size:14px;
      font-weight:700;
      margin-bottom:6px;
    }
    .qa-a {
      font-size:13px;
      color:#374151;
      white-space:pre-line;
    }

    .empty-text {
      font-size:13px;
      color:#9ca3af;
    }

    /* RIGHT SIDE */
    .right-box {
      width:35%;
    }

    .side-card {
      background:white;
      padding:24px 22px;
      border-radius:16px;
      margin-top:119px;
      border:1px solid var(--line);
      box-shadow:0 4px 15px rgba(0,0,0,0.08);
      position:sticky;
      top:30px;
    }

    .side-tabs {
      display:flex;
      gap:8px;
      margin-bottom:14px;
    }
    .side-tab {
      flex:1;
      padding:8px 0;
      border-radius:999px;
      border:1px solid #d1d5db;
      background:#f9fafb;
      font-size:12px;
      font-weight:700;
      color:#4b5563;
      cursor:pointer;
    }
    .side-tab.active {
      background:#eef3ff;
      border-color:var(--primary);
      color:var(--primary);
    }

    .side-price-box {
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 20px 16px 18px;
    }

    .side-title {
      font-size: 17px;
      font-weight: 800;
      margin-bottom: 6px;
    }

    .side-price {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 6px;
    }

    .side-duration {
      font-size: 13px;
      margin-bottom: 16px;
      color: #6b7280;
    }

    .side-offer {
      font-size: 13px;
      color: #374151;
      line-height: 1.6;
      border-top: 1px solid #f1f1f1;
      padding-top: 14px;
    }

    .btn-contact,
    .btn-buy {
      width:100%;
      padding:13px 0;
      border:none;
      border-radius:10px;
      cursor:pointer;
      color:#fff;
      font-size:15px;
      font-weight:700;
      margin-bottom:10px;
      background:var(--primary);
      border:2px solid var(--primary);
      transition:.2s;
    }
    .btn-contact:hover,
    .btn-buy:hover {
      background:var(--primary-dark);
    }

    .notice-box {
      font-size:11px;
      color:#777;
      margin-top:10px;
      line-height:1.5;
    }

    /* EXPERT BOX */
    .expert-box {
      background: #fff;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .expert-top {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 18px;
    }

    .expert-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
    }

    .expert-info { 
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .expert-name {
      font-size: 20px;
      font-weight: 800;
    }

    .expert-meta {
      font-size: 13px;
      color: #6b7280;
    }

    .expert-intro-full {
      font-size: 14px;
      color: #333;
      line-height: 1.7;
      max-height: 100px;
      overflow: hidden;
      transition: .3s;
      white-space: pre-line;
    }

    .expert-toggle-btn {
      margin-top: 10px;
      display: inline-block;
      font-size: 13px;
      font-weight: 700;
      color: var(--primary);
      cursor: pointer;
      user-select:none;
    }

    /* RESPONSIVE */
    @media (max-width:900px){
      .wrapper {
        flex-direction:column;
      }
      .left-box, .right-box {
        width:100%;
      }
      .side-card {
        position:static;
        margin-top:30px;
      }
    }

    /* OFFER LIST FIX */
    #bottomOffer ul,
    #sideOffer ul {
      list-style: disc !important;
      padding-left: 18px;
    }

    /* TOAST */
    .toast {
  position: fixed;
  bottom: 36px;
  right: 36px;
  min-width: 260px;
  max-width: 340px;
  background: #111827;
  color: #fff;
  padding: 16px 18px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 700;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
  opacity: 0;
  transform: translateY(20px);
  transition: .3s;
  z-index: 9999;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

.toast button {
  margin-top: 10px;
  width: 100%;
  padding: 10px 0;
  border-radius: 10px;
  border: none;
  font-size: 13px;
  font-weight: 800;
  cursor: pointer;
  background: #0056ff;
  color: #fff;
}


  </style>
</head>

<body>

<header>
  <div class="logo" onclick="location.href='index.html'">BlueOn</div>
</header>

<div id="toast" class="toast">ì—…ë°ì´íŠ¸ ì™„ë£Œ!</div>

<div class="wrapper">

  <!-- LEFT -->
  <div class="left-box">

    <div class="hero-top">
      <div id="heroTitle" class="hero-title"></div>
      <div class="hero-meta">
        <span id="heroMainCat"></span>
        <span>Â·</span>
        <span id="heroSubCat"></span>
      </div>
      <div id="keywordWrap" class="keyword-wrap"></div>
    </div>

    <div class="main-image-wrapper">
      <img id="mainSlideImg" alt="ì„œë¹„ìŠ¤ ë©”ì¸ ì´ë¯¸ì§€" />
    </div>

    <div id="thumbRow" class="thumbnail-row"></div>

    <div class="price-section">
      <div class="price-section-title">ê°€ê²© ì •ë³´</div>
      <div id="priceDetailArea"></div>
      <div id="pkgTabs" class="pkg-tab-row" style="display:none;"></div>
      <div id="priceCard" class="price-card"></div>
    </div>

    <div class="tabs-nav-wrap">
      <div class="tab-nav active" data-target="sec-desc">ì„œë¹„ìŠ¤ ì„¤ëª…</div>
      <div class="tab-nav" data-target="sec-price">ê°€ê²© ì •ë³´</div>
      <div class="tab-nav" data-target="sec-expert">ì „ë¬¸ê°€ ì •ë³´</div>
      <div class="tab-nav" data-target="sec-project">í”„ë¡œì íŠ¸ ê²½í—˜</div>
      <div class="tab-nav" data-target="sec-review">ë¦¬ë·°</div>
    </div>

    <section id="sec-desc" class="section-block">
      <div class="section-title">ì„œë¹„ìŠ¤ ì„¤ëª…</div>

      <div class="sub-title">ì„œë¹„ìŠ¤ ì†Œê°œ</div>
      <div id="descText" class="text-box"></div>

      <div class="sub-title">ë¸Œëœë“œ ë°©í–¥ / ì»¨ì…‰</div>
      <div id="brandText" class="text-box"></div>

      <div class="sub-title">ì‘ì—… í”„ë¡œì„¸ìŠ¤</div>
      <div id="processText" class="text-box"></div>

      <div class="sub-title">ìƒì„¸ ì´ë¯¸ì§€</div>
      <div id="detailImagesBox"></div>
    </section>

    <section id="sec-price" class="section-block">
      <div class="section-title">ê°€ê²© ì •ë³´</div>

      <div id="priceBottomTabs" class="pkg-tab-row"></div>

      <div class="price-box" id="bottomPriceBox"
           style="padding:20px; border:1px solid #e5e7eb; border-radius:12px; background:white;">

        <div class="price-row"
             style="display:flex; justify-content:space-between; align-items:center; margin-bottom:14px;">
          <div id="bottomPriceAmount" style="font-size:22px; font-weight:800;"></div>
          <button class="price-buy-btn"
                  style="padding:10px 18px; background:#111; color:white; border:none; border-radius:8px; font-weight:700; cursor:pointer;">
            êµ¬ë§¤í•˜ê¸°
          </button>
        </div>

        <div id="bottomPriceDesc"
             style="font-size:14px; color:#333; margin-bottom:18px;"></div>

        <div class="price-table" style="font-size:14px; line-height:1.7;">

          <div class="row"
               style="display:flex; justify-content:space-between;">
            <span class="cell-name">ì‘ì—… ê¸°ê°„</span>
            <span id="bottomDuration"></span>
          </div>

          <div class="row"
               style="display:flex; justify-content:space-between;">
            <span class="cell-name">ìˆ˜ì • íšŸìˆ˜</span>
            <span id="bottomRevision"></span>
          </div>

          <div class="row" style="margin-top:12px;">
            <span class="cell-name">ì œê³µ í•­ëª©</span>
          </div>
          <div id="bottomOffer" style="margin-top:4px;"></div>

        </div>

      </div>

    </section>

<!-- LEFT BOX ë‚´ë¶€ ëë¶€ë¶„ (ê¸°ì¡´ ì½˜í…ì¸  ì•„ë˜ì— ì´ì–´ì„œ) -->

<!-- â­ ì „ë¬¸ê°€ ì •ë³´ ì„¹ì…˜ì„ sec-expertë¡œ ë¬¶ì–´ì„œ ì •í™•í•œ ìŠ¤í¬ë¡¤ íƒ€ê²Ÿ ì œê³µ -->
<section id="sec-expert" class="section-block">

  <div class="section-title">ì „ë¬¸ê°€ ì •ë³´</div>

  <div class="expert-box">

    <div class="expert-row">

      <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
      <img id="expertAvatar" class="expert-avatar" alt="ì „ë¬¸ê°€ í”„ë¡œí•„" />

      <div class="expert-info-area">

        <div class="expert-header-line">

          <div class="expert-info-left">
            <div id="expertName" class="expert-name"></div>
            <div class="expert-meta">
              ì—°ë½ ê°€ëŠ¥ ì‹œê°„ : ì–¸ì œë‚˜ ê°€ëŠ¥ Â· í‰ê·  ì‘ë‹µ ì‹œê°„ : 1ì‹œê°„ ì´ë‚´
            </div>
          </div>

        </div>

        <div id="expertIntroFull" class="expert-intro-full"></div>
        <div id="expertToggleBtn" class="expert-toggle-btn">ë”ë³´ê¸°</div>

      </div>

    </div>

  </div>

</section>


<!-- â­ í”„ë¡œì íŠ¸ ê²½í—˜ / ìš”ì²­ì‚¬í•­ -->
<section id="sec-project" class="section-block">
  <div class="section-title">í”„ë¡œì íŠ¸ ê²½í—˜ / ìš”ì²­ì‚¬í•­</div>
  <div id="qaList" class="qa-list"></div>
</section>

<!-- â­ ë¦¬ë·° ì„¹ì…˜ -->
<section id="sec-review" class="section-block">
  <div class="section-title">ë¦¬ë·°</div>
  <div class="empty-text">ì•„ì§ ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
</section>

</div> <!-- â†â†â† â­ ì—¬ê¸°ì„œ left-boxë¥¼ ì •í™•íˆ ë‹«ì•„ì¤˜ì•¼ ë ˆì´ì•„ì›ƒì´ ì•ˆ ê¹¨ì§ -->


<!-- ====================================================================== -->
<!--                             RIGHT SIDE BOX                              -->
<!-- ====================================================================== -->
<div class="right-box">

  <div class="side-card">

    <div id="sideTabs" class="side-tabs"></div>

    <div class="side-price-box">
      <div id="sideTitle" class="side-title"></div>
      <div id="sidePrice" class="side-price"></div>
      <div id="sideDuration" class="side-duration"></div>
      <div id="sideDesc" class="side-desc"></div>
      <div id="sideOffer" class="side-offer"></div>
    </div>

    <!-- ë¬¸ì˜í•˜ê¸° -->
    <button class="btn-contact" onclick="openChat()">ë¬¸ì˜í•˜ê¸°</button>

    <!-- êµ¬ë§¤í•˜ê¸° -->
    <button class="btn-buy">êµ¬ë§¤í•˜ê¸°</button>

    <div class="notice-box">
      ì„œë¹„ìŠ¤ ì œê³µ ì™„ë£Œ í›„ ì „ë¬¸ê°€ì—ê²Œ ì „ë‹¬ë˜ë©° ì•ˆì „í•˜ê²Œ ê±°ë˜í•˜ì„¸ìš”.<br>
      ê²°ì œ ì‹œ ìˆ˜ìˆ˜ë£Œ 4.5%(VAT í¬í•¨)ê°€ ì¶”ê°€ë¼ìš”.

      <p style="font-size:12px; color:#6b7280; margin-top:8px;">

        <span id="openRefundPolicy"
              style="cursor:pointer; text-decoration:underline;">
          í™˜ë¶ˆ ì •ì±… ë³´ê¸°
        </span>

        <span style="color:#d1d5db;"> | </span>

        <span id="openSupport"
              style="cursor:pointer; text-decoration:underline;">
          ê³ ê° ì§€ì› ì„¼í„°
        </span>

      </p>

    </div>

  </div>

</div> <!-- right-box ë -->



      </div>

    </div>
  </div>

</div>

</div>



  <script>
const API = "https://blueon.up.railway.app";
const serviceId = new URLSearchParams(location.search).get("id");
let slideImgs = [];
/* â­ í™•ì¥ ë‹¨ê³„ ê·¸ë£¹ â†’ task_expand_x ë§¤í•‘ */
const EXPAND_KEY_MAP = {
  expand_channel: "task_expand_1",
  auto_system: "task_expand_2",
  expand_brand_model: "task_expand_3",
  data_marketing: "task_expand_4"
};

/* -------------------------------------------------------
   â­ ë¡œë“œë§µ ìƒíƒœ ì €ì¥/í¼ì„¼íŠ¸ ê³„ì‚°
------------------------------------------------------- */
const BRAND_TASKS  = ["task_logo", "task_color", "task_story", "task_programming"];
const SPREAD_TASKS = ["task_spread"];
// í™•ì¥ì€ service-detail í˜ì´ì§€ì—ì„œ ê´€ë¦¬ë¨

/* ì „ì²´ í¼ì„¼íŠ¸ ê³„ì‚° */
function updateBrandProgressUI() {
  const all = [...BRAND_TASKS, ...SPREAD_TASKS];
  const doneCount = all.filter(k => localStorage.getItem(k) === "done").length;
  const percent = Math.round((doneCount / all.length) * 100);

  console.log("ğŸ“ˆ ë¸Œëœë“œ ë¡œë“œë§µ ê°±ì‹ :", percent + "%");

  const bar = document.querySelector("#brandProgressBar");
  const txt = document.querySelector("#brandProgressText");

  if (bar) bar.style.width = percent + "%";
  if (txt) txt.textContent = percent + "%";
}

/* ì´ˆê¸°í™” í•¨ìˆ˜ â€” ê°œë°œììš© */
function clearBrandProgress() {
  [...BRAND_TASKS, ...SPREAD_TASKS].forEach(k => localStorage.removeItem(k));
  updateBrandProgressUI();
}

/* -------------------------------------------------------
   ê³µí†µ ìœ í‹¸
------------------------------------------------------- */
function safeParse(v){
  if (v == null) return null;
  if (typeof v === "object") return v;
  try { return JSON.parse(v); }
  catch { return null; }
}

function normalize(str){
  return String(str||"")
    .replace(/[\u200B-\u200D\uFEFF]/g, "")
    .replace(/\s+/g,"")
    .trim();
}

/* -------------------------------------------------------
   ì „ì²´ ì¹´í…Œê³ ë¦¬ (ìµœì‹ ë³¸)
------------------------------------------------------- */
const categoryMap = {
  brand_design: [
  "ìƒì„¸í˜ì´ì§€ ì œì‘",
  "ë°°ë„ˆ ë””ìì¸",
  "ë¡œê³ ë””ìì¸",  // â† ë„ì–´ì“°ê¸° ì œê±°
  "ë¸Œëœë“œ í‚¤ë¹„ì£¼ì–¼",
  "SNS ì¹´ë“œ ë‰´ìŠ¤"
],

  shop_build: [
    "ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì»¤ìŠ¤í„°ë§ˆì´ì§•","ìì‚¬ëª° êµ¬ì¶•",
    "ëœë”©í˜ì´ì§€ ì œì‘","í™ˆí˜ì´ì§€ ê°œë°œ"
  ],
  marketing: [
    "ì¸ìŠ¤íƒ€ê·¸ë¨ ìš´ì˜ ëŒ€í–‰","ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìµœì í™”",
    "SEO ìƒìœ„ë…¸ì¶œ","ê´‘ê³  ì§‘í–‰","í‹±í†¡ ë§ˆì¼€íŒ…"
  ],
  development: [
    "API ì—°ë™","ë°±ì—”ë“œ ê°œë°œ","ê´€ë¦¬ì í˜ì´ì§€ ê°œë°œ",
    "ìë™í™”Â·ë´‡ ì‹œìŠ¤í…œ ê°œë°œ","ì‡¼í•‘ëª° ì»¤ìŠ¤í„°ë§ˆì´ì§• ê¸°ëŠ¥ ê°œë°œ"
  ],
  brand_spread: [
    "ìˆí¼ ì˜ìƒ ì œì‘","ì œí’ˆ ì´¬ì˜","ë¦¬ë·° ì˜ìƒ ì œì‘",
    "ë¸Œëœë“œ ìŠ¤í† ë¦¬ ì˜ìƒ ì œì‘","ì œí’ˆ ì†Œê°œ ì˜ìƒ ì œì‘"
  ],
  brand_setting: [
    "SNS ê³„ì • ë¸Œëœë”©","ë¸Œëœë“œ ê³„ì • ì„¸íŒ…",
    "SNS ê³„ì • í™œì„±í™” ì„œë¹„ìŠ¤","ì¸í”Œë£¨ì–¸ì„œ ë§ˆì¼€íŒ…"
  ],
  template: [
    "ì¹´ë“œë‰´ìŠ¤ í…œí”Œë¦¿","í”¼ë“œ ë””ìì¸ í…œí”Œë¦¿",
    "SNS ì´ë²¤íŠ¸ ë””ìì¸","SNS ë””ìì¸ í…œí”Œë¦¿ íŒ¨í‚¤ì§€"
  ],
  brand_SEO: [
    "ê²€ìƒ‰ ìƒìœ„ë…¸ì¶œ íŒ¨í‚¤ì§€","í‚¤ì›Œë“œ ìƒìœ„ë…¸ì¶œ ì„œë¹„ìŠ¤",
    "ë„¤ì´ë²„Â·êµ¬ê¸€ ê²€ìƒ‰ ë…¸ì¶œ ìµœì í™”","SEO íŠ¸ë˜í”½ ìƒìŠ¹ ì„œë¹„ìŠ¤"
  ],
  youtube_channel: [
    "ìœ íŠœë¸Œ ì˜ìƒ í¸ì§‘","ìœ íŠœë¸Œ ì˜ìƒ ì»¤ë²„ ë””ìì¸",
    "ìœ íŠœë¸Œ ì¸ë„¤ì¼ íŒ¨í‚¤ì§€","ìœ íŠœë¸Œ ì˜ìƒ ì˜¤í”„ë‹ Â· ì—”ë”© ë””ìì¸"
  ],
  SNS_design: [
    "SNS ëœë”© í˜ì´ì§€ ì œì‘","SNS ë°”ì´ëŸ´ ë§ˆì¼€íŒ…","SNS í™œìš© ì´ë²¤íŠ¸ ê¸°íš"
  ],
  expand_channel: [
    "ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ìš´ì˜ Â· ë¦¬ë·° ê´€ë¦¬ ","ìœ íŠœë¸Œ ì±„ë„ ìš´ì˜ Â· ì‡¼ì¸  ì œì‘",
    "ìì‚¬ëª° CRO","ë„¤ì´ë²„ ì¹´í˜ ë§ˆì¼€íŒ…"
  ],
  auto_system: [
    "ê³ ê° ì„¸ê·¸ë¨¼íŠ¸ ìë™ ë¶„ë¥˜(ì‹ ê·œÂ·ì´íƒˆÂ·ì¬êµ¬ë§¤ ê³ ê°)",
    "SNS ê²Œì‹œë¬¼/ê´‘ê³  ìë™ ì˜ˆì•½Â·ë°œí–‰",
    "ì£¼ë¬¸/ì¬ê³  ë³€ë™ ì‹œ ìë™ ê¸°ë¡Â·ìë™ ì—…ë°ì´íŠ¸",
    "ì‹¤ì‹œê°„ ë¬¸ì˜ â†’ ìƒë‹´ì›(ì „ë¬¸ê°€) ìë™ ì—°ê²°"
  ],
  expand_brand_model: [
    "ì‹œì¦Œ í•œì •/í…Œë§ˆ ì œí’ˆ ê°œë°œ","ë¸Œëœë“œ ë©¤ë²„ì‹­/í¬ì¸íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶•",
    "ì˜¤í”„ë¼ì¸ íŒì—…ìŠ¤í† ì–´ ê¸°íš","ì „ë¬¸ê°€/ê¸°ì—… ëŒ€ìƒ ì œí’ˆ ê¸°íš"
  ],
  data_marketing: [
    "ê³ ê° ë°ì´í„° ë¶„ì„","CRM ì„¸íŒ… Â· ìë™í™” êµ¬ì¶•",
    "ë¦¬í…ì…˜ ë§ˆì¼€íŒ… ì„¤ê³„","ë°ì´í„° ê¸°ë°˜ ê´‘ê³  ìµœì í™”"
  ]
};

/* -------------------------------------------------------
   â¬‡ï¸ ì—­ë§¤í•‘ ìƒì„±: "ë¡œê³ ë””ìì¸" â†’ brand_design
------------------------------------------------------- */
const reverseCategoryMap = {};
for (const group in categoryMap) {
  categoryMap[group].forEach(name => {
    reverseCategoryMap[normalize(name)] = group;
  });
}

console.log("ğŸ—‚ ìƒì„±ëœ reverseCategoryMap:", reverseCategoryMap);
/* -------------------------------------------------------
   â­ ì„¤ê³„ ë‹¨ê³„ ë§¤í•‘ (A ë°©ì‹)
   groupKey â†’ ì„¤ê³„ë‹¨ê³„ task_key ë³€í™˜
------------------------------------------------------- */
const DESIGN_KEY_MAP = {
  brand_design: "task_logo",
  marketing: "task_story",
  shop_build: "task_programming",
  development: "task_programming"
};

/* -------------------------------------------------------
   â­ ë¸Œëœë“œ í™•ì‚°(Spread) ì¹´í…Œê³ ë¦¬
------------------------------------------------------- */
/* -------------------------------------------------------
   â­ í™•ì‚° ë‹¨ê³„ ì „ì²´ ì¹´í…Œê³ ë¦¬ ìë™ ì •ê·œí™” ë¦¬ìŠ¤íŠ¸
------------------------------------------------------- */

const spreadRawList = [
  "ì¸ìŠ¤íƒ€ê·¸ë¨ ëŒ€í–‰",
  "ì²´í—˜ë‹¨ ëª¨ì§‘",
  "ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…",
  "SNS ê³„ì • ì„¸íŒ…",
  "ì¸í”Œë£¨ì–¸ì„œ ë§ˆì¼€íŒ…",
  "SNS ë°”ì´ëŸ´ ìº í˜ì¸ ì½˜í…ì¸  íŒ¨í‚¤ì§€",

  "SNS í…œí”Œë¦¿ íŒ¨í‚¤ì§€ ì œì‘",
  "ì¸ìŠ¤íƒ€ í”¼ë“œ í…œí”Œë¦¿",
  "ì‡¼í•‘ëª° ì´ë²¤íŠ¸ í…œí”Œë¦¿",

  "SEO ìµœì í™” ë…¸ì¶œ",
  "SNS ìˆí¼ ë°”ì´ëŸ´ íŒ¨í‚¤ì§€",
  "ì œí’ˆ ë¦¬ë·° ì½˜í…ì¸  ì œì‘",

  "ìœ íŠœë¸Œ ì˜ìƒ í¸ì§‘ ë””ìì¸",
  "ìœ íŠœë¸Œ ì˜ìƒ ì»¤ë²„ Â· ì„¬ë„¤ì¼ íŒ¨í‚¤ì§€",
  "ìœ íŠœë¸Œ ì˜ìƒ ì˜¤í”„ë‹ Â· ì—”ë”© ë””ìì¸",

  "SNS ëœë”© í˜ì´ì§€ ì œì‘",
  "SNS ë°”ì´ëŸ´ ë§ˆì¼€íŒ…",
  "SNS í™œìš© ì´ë²¤íŠ¸ ê¸°íš",
  "CRM ì„¸íŒ… Â· ìë™í™” êµ¬ì¶•"
];

/* â­ ì •ê·œí™” */
const spreadNorm = spreadRawList.map(v => normalize(v));
console.log("ğŸ“¦ spreadNorm:", spreadNorm);

/* -------------------------------------------------------
   â­ í† ìŠ¤íŠ¸ ì•Œë¦¼
------------------------------------------------------- */
function showToast(msg) {
  const t = document.getElementById("toast");
  if (!t) return console.warn("toast ìš”ì†Œ ì—†ìŒ");

  t.textContent = msg;
  t.classList.add("show");
  setTimeout(() => t.classList.remove("show"), 1800);
}

/* ======================================================
   â­ í™•ì‚° ë‹¨ê³„ 6ê°œ ê·¸ë£¹ ë§¤í•‘
====================================================== */
const SPREAD_KEY_MAP = {
  brand_spread: "task_spread_1",
  brand_setting: "task_spread_2",
  template: "task_spread_3",
  brand_SEO: "task_spread_4",
  youtube_channel: "task_spread_5",
  SNS_design: "task_spread_6"
};


/* ======================================================
   â­ êµ¬ë§¤ â†’ ì„¤ê³„ / í™•ì‚° / í™•ì¥ ë‹¨ê³„ ì²˜ë¦¬ + DB êµ¬ë§¤ìˆ˜ ì¦ê°€
   (ì‹ ê·œ task_key ìš°ì„  ì ìš© + ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ ë°©ì‹ ì™„ì „ í˜¸í™˜)
====================================================== */
function initBuyButtons() {
  const buttons = document.querySelectorAll(".btn-buy, .price-buy-btn");
  console.log("ğŸ§· êµ¬ë§¤ ë²„íŠ¼ ê°œìˆ˜:", buttons.length);

  buttons.forEach((btn) => {
    btn.onclick = async () => {
      console.log("ğŸ–± êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ë¨!");

      /* ----------------------------------------------------
         1) serviceId í™•ì¸
      ---------------------------------------------------- */
      if (!serviceId) {
        console.warn("âŒ URLì— ?id= ê°€ ì—†ìŠµë‹ˆë‹¤.");
        showToast("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.");
        return;
      }

      let finalTaskKey = null;
      let phase = null;

      /* ----------------------------------------------------
         2) ì‹ ê·œ ì„œë¹„ìŠ¤: ì„œë²„ task_key ìš°ì„ 
      ---------------------------------------------------- */
      if (window.serviceTaskKey) {
        finalTaskKey = window.serviceTaskKey;

        if (
          finalTaskKey.startsWith("task_logo") ||
          finalTaskKey.startsWith("task_color") ||
          finalTaskKey.startsWith("task_story") ||
          finalTaskKey.startsWith("task_programming")
        ) {
          phase = "design";
        } else if (finalTaskKey.startsWith("task_spread")) {
          phase = "spread";
        } else if (finalTaskKey.startsWith("task_expand")) {
          phase = "expand";
        }
      }

      /* ----------------------------------------------------
         3) ë°±ì—…: ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ë§¤í•‘
      ---------------------------------------------------- */
      if (!finalTaskKey) {
        const rawSub = (document.getElementById("heroSubCat")?.textContent || "").trim();
        const normSub = normalize(rawSub);
        const groupKey = reverseCategoryMap[normSub] || null;

        if (groupKey && DESIGN_KEY_MAP[groupKey]) {
          finalTaskKey = DESIGN_KEY_MAP[groupKey];
          phase = "design";
        } else if (groupKey && SPREAD_KEY_MAP[groupKey]) {
          finalTaskKey = SPREAD_KEY_MAP[groupKey];
          phase = "spread";
        } else if (groupKey && EXPAND_KEY_MAP[groupKey]) {
          finalTaskKey = EXPAND_KEY_MAP[groupKey];
          phase = "expand";
        }
      }

      /* ----------------------------------------------------
         4) ë¡œì»¬ ë¡œë“œë§µ ì—…ë°ì´íŠ¸ (UXìš©)
         âš ï¸ ì„œë²„ ìƒíƒœì™€ ë¬´ê´€ (ì„ì‹œ UX)
      ---------------------------------------------------- */
      if (finalTaskKey && localStorage.getItem(finalTaskKey) !== "done") {
        localStorage.setItem(finalTaskKey, "done");

        if (phase === "design") showToast("ë¸Œëœë“œ ì„¤ê³„ ë‹¨ê³„ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!");
        if (phase === "spread") showToast("ë¸Œëœë“œ í™•ì‚° ë‹¨ê³„ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!");
        if (phase === "expand") showToast("ë¸Œëœë“œ í™•ì¥ ë‹¨ê³„ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!");

        if (phase === "design"  && typeof updateBrandProgressUI === "function") updateBrandProgressUI();
        if (phase === "spread"  && typeof updateSpreadProgressUI === "function") updateSpreadProgressUI();
        if (phase === "expand"  && typeof updateExpandProgressUI === "function") updateExpandProgressUI();
      }

      /* ----------------------------------------------------
         5) ğŸ”¥ ì£¼ë¬¸ ìƒì„± (ë¬´í†µì¥)
      ---------------------------------------------------- */
      try {
        const res = await fetch(`${API}/orders/create`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ serviceId }),
        });

        if (!res.ok) {
          console.error("âŒ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜:", res.status);
          showToast("ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          return;
        }

        const data = await res.json();

        /* ---------------------------------
           5-1) ì¤‘ë³µ ì…ê¸ˆ ëŒ€ê¸° ì£¼ë¬¸
        --------------------------------- */
        if (!data.success && data.code === "DUPLICATE_PENDING") {
          showToast("ì´ë¯¸ ì…ê¸ˆ ëŒ€ê¸° ì¤‘ì¸ ì£¼ë¬¸ì´ ìˆìŠµë‹ˆë‹¤.\nì‘ì—… í™•ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");

          setTimeout(() => {
            // âš ï¸ ë‚˜ì¤‘ì— my-orders.htmlë¡œ êµì²´
            location.href = `/order-pay.html?orderId=${data.orderId}`;
          }, 1200);

          return;
        }

        /* ---------------------------------
           5-2) ê¸°íƒ€ ì‹¤íŒ¨
        --------------------------------- */
        if (!data.success) {
          console.error("âŒ ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨:", data);
          showToast("ì£¼ë¬¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          return;
        }

        const orderId = data.orderId;
        console.log("ğŸ§¾ ì£¼ë¬¸ ìƒì„± ì™„ë£Œ:", orderId);

        /* ----------------------------------------------------
           6) êµ¬ë§¤ ì¹´ìš´íŠ¸ ì¦ê°€ (í†µê³„ìš©, ì‹¤íŒ¨í•´ë„ ë¬´ì‹œ)
        ---------------------------------------------------- */
        fetch(`${API}/services/${serviceId}/buy-count`, {
          method: "POST",
          credentials: "include",
        }).catch(() => {});

        /* ----------------------------------------------------
           7) ì…ê¸ˆ í˜ì´ì§€ ì´ë™
        ---------------------------------------------------- */
        location.href = `/order-pay.html?orderId=${orderId}`;

      } catch (err) {
        console.error("âŒ ì£¼ë¬¸ ìƒì„± ì˜ˆì™¸:", err);
        showToast("ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    };
  });
}



/* =======================================================
   ê³µí†µ ìœ í‹¸
======================================================= */
function safeParse(val){
  if (val == null) return null;
  if (typeof val === "object") return val;
  try { return JSON.parse(val); }
  catch { return null; }
}

function normalize(str) {
  return String(str || "")
    .replace(/[\u200B-\u200D\uFEFF]/g, "")
    .replace(/\s+/g, "")
    .trim();
}

/* =======================================================
   ì „ë¬¸ê°€ í”„ë¡œí•„ ë°•ìŠ¤
======================================================= */
function initExpertBox(ex){
  const avatar=document.getElementById("expertAvatar");
  const nameEl=document.getElementById("expertName");
  const intro=document.getElementById("expertIntroFull");
  const toggle=document.getElementById("expertToggleBtn");

  avatar.src = ex.avatar_url || "/assets/default_profile.png";
  nameEl.textContent = ex.nickname || "ì „ë¬¸ê°€";
  intro.textContent = ex.intro || "ë“±ë¡ëœ ì†Œê°œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.";

  let opened=false;
  toggle.onclick = ()=>{
    opened=!opened;
    if(opened){
      intro.style.maxHeight="2000px";
      toggle.textContent="ì ‘ê¸°";
    }else{
      intro.style.maxHeight="100px";
      toggle.textContent="ë”ë³´ê¸°";
    }
  };
}

/* =======================================================
   ê°€ê²© UI â€“ ë‹¨ì¼ ê°€ê²©
======================================================= */
function renderSinglePrice(service){
  const sideTitleEl    = document.getElementById("sideTitle");
  const sidePriceEl    = document.getElementById("sidePrice");
  const sideDurationEl = document.getElementById("sideDuration");
  const sideOfferEl    = document.getElementById("sideOffer");

  const bottomPriceAmount = document.getElementById("bottomPriceAmount");
  const bottomDuration    = document.getElementById("bottomDuration");
  const bottomRevision    = document.getElementById("bottomRevision");
  const bottomOffer       = document.getElementById("bottomOffer");

  const title    = service.title || "-";
  const price    = service.price_basic ? Number(service.price_basic).toLocaleString() : "0";
  const duration = service.duration || "-";
  const revision = service.revision_count || "-";

  const offerRaw   = service.offer_items || "";
  const offerItems = offerRaw
    .split("\n")
    .map(v => v.replace(/^[â€¢â—â—‹â—¦â–ªâ–«â€£âƒâ€“â€”\-]+\s*/, "")) 
    .filter(v => v.trim() !== "");

  if (sideTitleEl)    sideTitleEl.textContent = title;
  if (sidePriceEl)    sidePriceEl.textContent = price + "ì›";
  if (sideDurationEl) sideDurationEl.textContent = `ì‘ì—… ê¸°ê°„: ${duration} Â· ìˆ˜ì • íšŸìˆ˜: ${revision}`;
  if (sideOfferEl) {
    sideOfferEl.innerHTML = `<ul>${offerItems.map(v => `<li>${v}</li>`).join("")}</ul>`;
  }

  if (bottomPriceAmount) bottomPriceAmount.textContent = price + "ì›";
  if (bottomDuration)    bottomDuration.textContent    = duration;
  if (bottomRevision)    bottomRevision.textContent    = revision;
  if (bottomOffer) {
    bottomOffer.innerHTML = `<ul>${offerItems.map(v => `<li>${v}</li>`).join("")}</ul>`;
  }
}

/* =======================================================
   ê°€ê²© UI â€“ íŒ¨í‚¤ì§€ ê°€ê²©
======================================================= */
function renderPackagePrice(svc){
  const pkgTabs    = document.getElementById("pkgTabs");
  const sideTabs   = document.getElementById("sideTabs");
  const bottomTabs = document.getElementById("priceBottomTabs");
  const priceCard  = document.getElementById("priceCard");

  const pkg = safeParse(svc.package_json);
  if(!pkg) return renderSinglePrice(svc);

  const order = ["BASIC","STANDARD","PREMIUM"].filter(k => pkg[k]);
  if(order.length === 0) return renderSinglePrice(svc);

  let current = order[0];
  const offerCommon = (svc.offer_items || "").toString();

  function updateUI(){
    const item = pkg[current] || {};
    const title    = item.title || `${current} íŒ¨í‚¤ì§€`;
    const priceNum = Number(item.price || 0);
    const price    = priceNum.toLocaleString() + "ì›";
    const duration = item.duration || "-";
    const revision = item.revision || "-";
    const desc     = (item.desc || "").toString();

    const offerLines = offerCommon.split("\n").filter(v => v.trim() !== "");
    const offerHTML  = `<ul>${offerLines.map(v=>`<li>${v}</li>`).join("")}</ul>`;

    if (priceCard) {
      priceCard.innerHTML = `
        <div class="price-card-title">${title}</div>
        <div class="price-card-main">
          <div class="price-card-price">${price}</div>
          <div class="price-card-meta">
            ì‘ì—… ê¸°ê°„: ${duration}<br>
            ìˆ˜ì • íšŸìˆ˜: ${revision}
          </div>
        </div>
        <div class="price-card-list-title">ì„¤ëª…</div>
        <div>${desc.replace(/\n/g,"<br>")}</div>
        <div class="price-card-list-title">ì œê³µ í•­ëª©</div>
        <div class="price-card-list">${offerHTML}</div>
      `;
    }

    const bottomPriceAmount = document.getElementById("bottomPriceAmount");
    const bottomDuration    = document.getElementById("bottomDuration");
    const bottomRevision    = document.getElementById("bottomRevision");
    const bottomOffer       = document.getElementById("bottomOffer");

    if (bottomPriceAmount) bottomPriceAmount.textContent = price;
    if (bottomDuration)    bottomDuration.textContent    = duration;
    if (bottomRevision)    bottomRevision.textContent    = revision;
    if (bottomOffer)       bottomOffer.innerHTML         = offerHTML;

    const sideTitleEl    = document.getElementById("sideTitle");
    const sidePriceEl    = document.getElementById("sidePrice");
    const sideDurationEl = document.getElementById("sideDuration");
    const sideOfferEl    = document.getElementById("sideOffer");

    if (sideTitleEl)    sideTitleEl.textContent = title;
    if (sidePriceEl)    sidePriceEl.textContent = price;
    if (sideDurationEl) sideDurationEl.textContent = `ì‘ì—… ê¸°ê°„: ${duration} Â· ìˆ˜ì • íšŸìˆ˜: ${revision}`;
    if (sideOfferEl)    sideOfferEl.innerHTML = offerHTML;
  }

  function buildTabs(){
    if (pkgTabs) {
      pkgTabs.innerHTML = "";
      pkgTabs.style.display = "flex";
      order.forEach(k => {
        const btn = document.createElement("button");
        btn.className = "pkg-tab";
        btn.textContent = k;
        if (k === current) btn.classList.add("active");
        btn.onclick = () => { current = k; buildTabs(); updateUI(); };
        pkgTabs.appendChild(btn);
      });
    }

    if (sideTabs) {
      sideTabs.innerHTML = "";
      order.forEach(k => {
        const btn = document.createElement("button");
        btn.className = "side-tab";
        btn.dataset.key = k;
        btn.textContent = k;
        if (k === current) btn.classList.add("active");
        btn.onclick = () => { current = k; buildTabs(); updateUI(); };
        sideTabs.appendChild(btn);
      });
    }

    if (bottomTabs) {
      bottomTabs.innerHTML = "";
      order.forEach(k => {
        const btn = document.createElement("button");
        btn.className = "pkg-tab";
        btn.dataset.key = k;
        btn.textContent = k;
        if (k === current) btn.classList.add("active");
        btn.onclick = () => { current = k; buildTabs(); updateUI(); };
        bottomTabs.appendChild(btn);
      });
    }
  }

  buildTabs();
  updateUI();
}

/* =======================================================
   Q&A ë Œë”ë§
======================================================= */
function renderQA(raw){
  const box = document.getElementById("qaList");
  box.innerHTML = "";

  const arr = safeParse(raw);
  if(!arr || arr.length===0){
    box.innerHTML = `<div class="empty-text">ë“±ë¡ëœ ìš”ì²­ì‚¬í•­/í”„ë¡œì íŠ¸ ê²½í—˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  arr.forEach(v=>{
    const card=document.createElement("div");
    card.className="qa-card";
    card.innerHTML = `
      <div class="qa-q">Q. ${v.question}</div>
      <div class="qa-a">${(v.answer||"").replace(/\n/g,"<br>")}</div>
    `;
    box.appendChild(card);
  });
}

/* =======================================================
   ì„œë¹„ìŠ¤ ìƒì„¸ ì •ë³´ ë¡œë”© (ìˆ˜ì • ì™„ì „ë³¸)
======================================================= */
async function loadService() {
  try {
    const res = await fetch(`${API}/services/${serviceId}`);
    const data = await res.json();

    console.log("ğŸ” ì„œë¹„ìŠ¤ ìƒì„¸ expert êµ¬ì¡°:", data.expert);

    const svc    = data.service;
    const expert = data.expert || {};

    /* --------------------------------------------------
       â­ ì‹ ê·œ ì„œë¹„ìŠ¤ìš© task_key ì €ì¥
    -------------------------------------------------- */
    window.serviceTaskKey = svc.task_key || null;
    console.log("ğŸ¯ service task_key:", window.serviceTaskKey);

    document.getElementById("heroTitle").textContent    = svc.title;
    document.getElementById("heroMainCat").textContent  = svc.main_category;
    document.getElementById("heroSubCat").textContent   = svc.sub_category;

    // í‚¤ì›Œë“œ
    const wrap = document.getElementById("keywordWrap");
    wrap.innerHTML = "";
    (svc.keywords || "").split(",").forEach(k => {
      if (!k.trim()) return;
      const chip = document.createElement("span");
      chip.className = "keyword-chip";
      chip.textContent = "#" + k.trim();
      wrap.appendChild(chip);
    });

    // ë©”ì¸ ì´ë¯¸ì§€
    slideImgs = safeParse(svc.main_images) || [];
    const main = document.getElementById("mainSlideImg");
    main.src = slideImgs[0] || "/assets/default_service.png";

    const thumb = document.getElementById("thumbRow");
    thumb.innerHTML = "";
    slideImgs.forEach((img, i) => {
      const t = document.createElement("img");
      t.src = img;
      if (i === 0) t.classList.add("active");
      t.onclick = () => {
        main.src = img;
        document.querySelectorAll("#thumbRow img").forEach(x => x.classList.remove("active"));
        t.classList.add("active");
      };
      thumb.appendChild(t);
    });

    // ì„¤ëª…
    document.getElementById("descText").innerHTML =
      (svc.description || "").replace(/\n/g, "<br>");

    document.getElementById("brandText").innerHTML =
      (svc.brand_concept || "").replace(/\n/g, "<br>");

    document.getElementById("processText").innerHTML =
      (svc.process || "").replace(/\n/g, "<br>");

    // ìƒì„¸ ì´ë¯¸ì§€
    const dbox = document.getElementById("detailImagesBox");
    dbox.innerHTML = "";
    (safeParse(svc.detail_images) || []).forEach(img => {
      const el = document.createElement("img");
      el.src = img;
      el.className = "detail-image";
      dbox.appendChild(el);
    });

    // ì „ë¬¸ê°€ ì •ë³´
    initExpertBox(expert);

    // ğŸ”¥ ì „ë¬¸ê°€ user_id ì €ì¥
    window.expertId = expert.user_id;
    console.log("ğŸŸ¦ expertId ìµœì¢… ì„¤ì •:", window.expertId);

    // ê°€ê²©
    if (svc.is_package_mode == 1) renderPackagePrice(svc);
    else renderSinglePrice(svc);

    // Q&A
    renderQA(svc.customer_request);

  } catch (e) {
    console.error(e);
    alert("ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
  }
}



/* =======================================================
   NAV íƒ­ ìŠ¤í¬ë¡¤ ì´ë™
======================================================= */
function initTabs() {
  document.querySelectorAll(".tab-nav").forEach(tab=>{
    tab.onclick=()=>{
      document.querySelectorAll(".tab-nav").forEach(t=>t.classList.remove("active"));
      tab.classList.add("active");

      const target=document.getElementById(tab.dataset.target);
      if (!target) return;
      const top=target.getBoundingClientRect().top + window.scrollY - 90;
      window.scrollTo({top,behavior:"smooth"});
    };
  });
}







/* =======================================================
   í˜ì´ì§€ ì´ˆê¸°í™”
======================================================= */
document.addEventListener("DOMContentLoaded", async () => {
  await loadService();
  initTabs();
  initBuyButtons();   // â† PART 2ì˜ í•µì‹¬ êµ¬ë§¤ ë§¤í•‘ ì½”ë“œ


});


function openChat() {
  if (!window.expertId) {
    alert("ì „ë¬¸ê°€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  console.log("ğŸ“¡ ë¬¸ì˜í•˜ê¸° â†’ ì±„íŒ…ë°© ì—°ê²° ì‹œì‘");

  fetch(`/chat/start`, {
    method: "POST",
    credentials: "include",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ targetId: window.expertId })   // â˜… ì—¬ê¸° ìˆ˜ì •
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      console.log("ğŸŸ¦ ì±„íŒ…ë°© ìƒì„± ì„±ê³µ:", data);
      location.href = `/chat.html?room=${data.roomId}&target=${window.expertId}`;
    } else {
      console.warn("âŒ ì±„íŒ…ë°© ìƒì„± ì‹¤íŒ¨:", data);
      alert("ì±„íŒ…ë°©ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
  })
  .catch(err => {
    console.error("âŒ fetch error:", err);
    alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
  });
}




document.addEventListener("DOMContentLoaded", () => {

  const refundBtn      = document.getElementById("openRefundPolicy");
  const supportBtn     = document.getElementById("openSupport");

  const refundModal    = document.getElementById("refundModal");
  const closeRefund    = document.getElementById("closeRefund");

  const supportModal   = document.getElementById("supportModal");
  const closeSupport   = document.getElementById("closeSupport");

  /* -------------------------------
     1. í™˜ë¶ˆ ì •ì±… ì´ë™
  --------------------------------*/
  if (refundBtn) {
    refundBtn.addEventListener("click", (e) => {
      e.preventDefault();
      window.location.href = "refund-policy.html";
    });
  }

  /* -------------------------------
     2. ê³ ê° ì§€ì› ì„¼í„° ëª¨ë‹¬ ì—´ê¸°
  --------------------------------*/
  if (supportBtn && supportModal) {
    supportBtn.addEventListener("click", (e) => {
      e.preventDefault();
      supportModal.style.display = "grid";
    });
  }

  /* -------------------------------
     3. ê³ ê°ì„¼í„° ë‹«ê¸° ë²„íŠ¼
  --------------------------------*/
  if (closeSupport) {
    closeSupport.addEventListener("click", () => {
      supportModal.style.display = "none";
    });
  }

  /* -------------------------------
     4. ê³ ê°ì„¼í„° ë°”ê¹¥ í´ë¦­ â†’ ë‹«ê¸°
  --------------------------------*/
  if (supportModal) {
    supportModal.addEventListener("click", (e) => {
      if (e.target === supportModal) {
        supportModal.style.display = "none";
      }
    });
  }

});

</script>

<!-- í™˜ë¶ˆ ì •ì±… ëª¨ë‹¬ -->
<div id="refundModal" style="
  position:fixed;
  inset:0;  
  background:rgba(0,0,0,0.55);
  display:none;
  place-items:center;
  z-index:9999;
">
  <div style="
    background:#fff;
    width:90%;
    max-width:720px;
    padding:30px;
    border-radius:16px;
    max-height:80vh;
    overflow-y:auto;
  ">
    <h2 style="font-size:22px; font-weight:800; margin-bottom:20px;">
      í™˜ë¶ˆ ì •ì±…
    </h2>

    <div id="refundContent" style="white-space:pre-line; font-size:14px; line-height:1.7;">
      <!-- í™˜ë¶ˆ ì •ì±… ì „ë¬¸ì´ JSë¡œ ì‚½ì…ë¨ -->
    </div>

    <button id="closeRefund" style="
      width:100%;
      margin-top:20px;
      background:#0056ff;
      color:#fff;
      border:none;
      padding:12px;
      border-radius:10px;
      font-size:15px;
      cursor:pointer;
    ">
      ë‹«ê¸°
    </button>
  </div>
</div>

<!-- ê³ ê° ì§€ì› ì„¼í„° ëª¨ë‹¬ -->
<div id="supportModal" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:none;
  place-items:center;
  z-index:9999;
">
  <div style="
    background:#fff;
    width:90%;
    max-width:720px;
    padding:30px;
    border-radius:16px;
    max-height:80vh;
    overflow-y:auto;
  ">

    <!-- Header -->
    <h2 style="font-size:22px; font-weight:800; margin-bottom:15px; color:#111827;">
      ê³ ê°ì„¼í„° Â· ë¬¸ì˜í•˜ê¸°
    </h2>

    <!-- Description -->
    <p style="color:#6b7280; font-size:14px; margin-bottom:20px;">
      BlueOn íŒ€ì´ ìµœëŒ€í•œ ë¹ ë¥´ê²Œ ë„ì›€ì„ ë“œë¦½ë‹ˆë‹¤.<br>
      ì•„ë˜ì—ì„œ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ì„ í™•ì¸í•˜ê±°ë‚˜, ì§ì ‘ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
    </p>

    <!-- FAQ BOX -->
    <div style="margin-bottom:25px;">
      <h3 style="font-size:15px; font-weight:700; margin-bottom:12px;">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h3>

      <!-- FAQ 1 -->
      <div style="margin-bottom:12px;">
        <div onclick="location.href='refund-policy.html'" style="
          padding:12px 14px;
          background:#f3f4f6;
          border-radius:10px;
          font-weight:600;
          cursor:pointer;
        ">
          ê²°ì œ/í™˜ë¶ˆì€ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ë‚˜ìš”?
        </div>
      </div>

      <!-- FAQ 2 -->
      <div style="margin-bottom:12px;">
        <div onclick="location.href='expert-inquiry-guide.html'" style="
          padding:12px 14px;
          background:#f3f4f6;
          border-radius:10px;
          font-weight:600;
          cursor:pointer;
        ">
          ì „ë¬¸ê°€ì—ê²Œ ì‘ì—… ë¬¸ì˜ë¥¼ ë‚¨ê¸°ê³  ì‹¶ì–´ìš”.
        </div>
      </div>

      <!-- FAQ 3 -->
      <div style="margin-bottom:12px;">
        <div onclick="location.href='work-not-satisfied.html'" style="
          padding:12px 14px;
          background:#f3f4f6;
          border-radius:10px;
          font-weight:600;
          cursor:pointer;
        ">
          ì‘ì—…ì´ ë§ˆìŒì— ë“¤ì§€ ì•Šì„ ë• ì–´ë–»ê²Œ í•˜ë‚˜ìš”?
        </div>
      </div>
    </div>

    <!-- Contact Information Box -->
    <div style="
      background:#eef4ff;
      border-left:4px solid #0056ff;
      padding:14px 18px;
      border-radius:10px;
      margin-bottom:20px;
      font-size:14px;
      line-height:1.7;
      color:#1e293b;
    ">
      <b>ğŸ“ ê³ ê°ì„¼í„° ì—°ë½ì²˜</b><br>
      ì´ë©”ì¼: <b>di702934@gmail.com</b><br>
      ì „í™”ë²ˆí˜¸: <b>010-3585-3426</b><br>
      ìš´ì˜ ì‹œê°„: í‰ì¼ 18:00 ~ 22:00
    </div>

    <!-- Close Button -->
    <button id="closeSupport" style="
      width:100%;
      margin-top:20px;
      background:#0056ff;
      color:#fff;
      border:none;
      padding:12px;
      border-radius:10px;
      font-size:15px;
      cursor:pointer;
    ">
      ë‹«ê¸°
    </button>

  </div>
</div>

<script src="/js/service-detail.js"></script>
<div id="toast" class="toast"></div>

</body>
</html>