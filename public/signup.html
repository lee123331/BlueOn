<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>íšŒì›ê°€ì… | BlueOn</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #0056ff;
      --gray-line: #e5e7eb;
      --text-gray: #6b7280;
      --white: #ffffff;
      --error: #ef4444;
      --success: #111;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Noto Sans KR", sans-serif;
      background-color: var(--white);
      color: #111827;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 30px 20px;
    }

    h1 { font-size: 26px; font-weight: 800; color: var(--primary); margin-bottom: 8px; }
    h2 { font-size: 17px; font-weight: 600; text-align: center; line-height: 1.6; margin-bottom: 35px; }

    /* í¼ */
    form {
      width: 100%;
      max-width: 430px;
      background: #fff;
      border: 1px solid var(--gray-line);
      border-radius: 16px;
      padding: 40px 30px;
      box-shadow: 0 4px 25px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 22px;
    }

    label { font-size: 14px; font-weight: 700; display: block; margin-bottom: 6px; }

    .input-wrap {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    input {
      width: 100%;
      padding: 14px 15px;
      border-radius: 10px;
      border: 1px solid var(--gray-line);
      font-size: 15px;
      transition: 0.2s;
      outline: none;
    }

    input.error {
      border-color: var(--error) !important;
      box-shadow: 0 0 0 2px rgba(239,68,68,0.15);
    }

    input.success {
      border-color: var(--success);
      box-shadow: 0 0 0 2px rgba(0,0,0,0.1);
    }

    .error-text {
      color: var(--error);
      font-size: 13px;
      margin-left: 4px;
      opacity: 0;
      max-height: 0;
      transition: all 0.25s ease;
      overflow: hidden;
    }

    .error-text.show {
      opacity: 1;
      max-height: 26px;
    }

    /* ì•½ê´€ */
    .terms {
      background: #f9fafb;
      border-radius: 12px;
      border: 1px solid var(--gray-line);
      padding: 22px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .terms h3 {
      font-size: 15px;
      font-weight: 700;
      color: #111;
      margin-bottom: 4px;
    }

    .term-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      line-height: 1.5;
    }

    .term-item input[type="checkbox"] {
      margin-top: 3px;
      width: 16px;
      height: 16px;
    }

    /* ë²„íŠ¼ */
    button {
      width: 100%;
      padding: 15px 0;
      font-size: 16px;
      font-weight: 700;
      border-radius: 10px;
      border: none;
      background: #bbb;
      color: white;
      cursor: not-allowed;
      transition: 0.2s;
      margin-top: 6px;
    }

    button.active {
      background: #111;
      cursor: pointer;
    }
    button.active:hover { background: #333; }

    /* ì„±ê³µ ëª¨ë‹¬ */
    #modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.85);
      background: #fff;
      padding: 40px 50px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.25);
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      z-index: 9999;
    }
    #modal.active {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }

    .modal-check {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      border: 4px solid #00c853;
      margin: 0 auto 16px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 6px;
    }

    .modal-msg {
      font-size: 14px;
      color: #555;
    }

    /* ì˜¤ë¥˜ ëª¨ë‹¬ */
    #errorModal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.25s;
    }
    #errorModal.active {
      display: flex;
      opacity: 1;
    }

    .error-box {
      background: #fff;
      padding: 32px 40px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      width: 330px;
    }

    .error-icon {
      font-size: 46px;
      margin-bottom: 12px;
      color: #ef4444;
    }

    #errorTitle {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 6px;
      color: #ef4444;
    }

    #errorMessage {
      font-size: 14px;
      line-height: 1.6;
      color: #555;
    }
  </style>
</head>

<body>

  <h1>BlueOn</h1>
  <h2>ì´ë©”ì¼ë¡œ<br>BlueOnì— ê°€ì…í•˜ì„¸ìš”</h2>

  <form id="signupForm" novalidate>

  <!-- ì´ë©”ì¼ -->
  <div>
    <label for="email">ì´ë©”ì¼</label>
    <div class="input-wrap">
      <input type="email" id="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”" />
      <p class="error-text" id="emailError">ì´ë©”ì¼ ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”.</p>
    </div>
  </div>

  <!-- ì „í™”ë²ˆí˜¸ ì¶”ê°€ -->
  <div>
    <label for="phone">íœ´ëŒ€í° ë²ˆí˜¸</label>
    <div class="input-wrap">
      <input type="text" id="phone" placeholder="ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 01012345678)" />
      <p class="error-text" id="phoneError">íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
    </div>
  </div>

  <!-- ë¹„ë°€ë²ˆí˜¸ -->
  <div>
    <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
    <div class="input-wrap">
      <input type="password" id="password" placeholder="ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 8ì ì´ìƒ" />
      <p class="error-text" id="passwordError">ë¹„ë°€ë²ˆí˜¸ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
    </div>
  </div>

  <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
  <div class="input-wrap">
    <input type="password" id="confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥í•´ ì£¼ì„¸ìš”" autocomplete="new-password">
    <p class="error-text" id="confirmError">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
  </div>

  <!-- ì•½ê´€ -->
  <div class="terms">
    <h3>ì•½ê´€ ë™ì˜</h3>

    <div class="term-item">
      <input type="checkbox" id="agreeAll">
      <label for="agreeAll"><strong>ëª¨ë‘ ë™ì˜í•©ë‹ˆë‹¤.</strong></label>
    </div>

    <div class="term-item">
      <input type="checkbox" class="term" id="term1">
      <label for="term1">ë§Œ 14ì„¸ ì´ìƒì…ë‹ˆë‹¤.</label>
    </div>

    <div class="term-item">
      <input type="checkbox" class="term" id="term2">
      <label for="term2">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
    </div>

    <div class="term-item">
      <input type="checkbox" class="term" id="term3">
      <label for="term3">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
    </div>
  </div>

  <button id="signupBtn" type="submit" disabled>ê°€ì…ì™„ë£Œ</button>

</form>


  <!-- ì„±ê³µ ëª¨ë‹¬ -->
  <div id="modal" class="modal">
    <div class="modal-check"></div>
    <h3 class="modal-title">íšŒì›ê°€ì… ì™„ë£Œ!</h3>
    <p class="modal-msg">ì ì‹œ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
  </div>

  <!-- ì˜¤ë¥˜ ëª¨ë‹¬ -->
  <div id="errorModal" class="error-modal">
    <div class="error-box">
      <div class="error-icon">âš ï¸</div>
      <h3 id="errorTitle">ì˜¤ë¥˜ ë°œìƒ</h3>
      <p id="errorMessage">ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
    </div>
  </div>

<script>
/* ===== ìš”ì†Œ ìºì‹± ===== */
const email     = document.getElementById("email");
const password  = document.getElementById("password");
const confirmPw = document.getElementById("confirm");
const btn       = document.getElementById("signupBtn");
const phoneInput = document.getElementById("phone");
const phoneError = document.getElementById("phoneError");
const signupBtn = document.getElementById("signupBtn");

/* ì˜¤ë¥˜ ë¬¸êµ¬ */
const emailError   = document.getElementById("emailError");
const passwordError= document.getElementById("passwordError");
const confirmError = document.getElementById("confirmError");

/* ëª¨ë‹¬ */
const successModal = document.getElementById("modal");
const errorModal   = document.getElementById("errorModal");
const errorTitle   = document.getElementById("errorTitle");
const errorMessage = document.getElementById("errorMessage");

/* ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ */
function showErrorModal(title, message) {
  if (!errorModal || !errorTitle || !errorMessage) return;

  errorTitle.textContent = title;
  errorMessage.textContent = message;

  errorModal.classList.add("active");
  setTimeout(() => {
    errorModal.classList.remove("active");
  }, 2000);
}

/* ì´ë©”ì¼ ê²€ì‚¬ */
function checkEmail() {
  const value = email.value.trim();
  const valid = /^[\w.-]+@[\w.-]+\.[A-Za-z]{2,}$/.test(value);

  email.classList.toggle("error", !valid && value.length > 0);
  email.classList.toggle("success", valid);
  emailError.classList.toggle("show", !valid && value.length > 0);

  return valid;
}

/* ë¹„ë°€ë²ˆí˜¸ ê²€ì‚¬ */
function checkPassword() {
  const value = password.value;
  const valid = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*]).{8,}$/.test(value);

  password.classList.toggle("error", !valid && value.length > 0);
  password.classList.toggle("success", valid);
  passwordError.classList.toggle("show", !valid && value.length > 0);

  return valid;
}

/* ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥ ê²€ì‚¬ */
function checkConfirm() {
  const pw = password.value;
  const cf = confirmPw.value;

  if (cf.length === 0) {
    confirmPw.classList.remove("error", "success");
    confirmError.classList.remove("show");
    return false;
  }

  const match = (pw === cf);

  if (!match) {
    confirmPw.classList.add("error");
    confirmPw.classList.remove("success");
    confirmError.classList.add("show");
  } else {
    confirmPw.classList.add("success");
    confirmPw.classList.remove("error");
    confirmError.classList.remove("show");
  }

  return match;
}

/* ë²„íŠ¼ í™œì„±í™” */
function updateButton() {
  const ready =
    checkEmail() &&
    checkPassword() &&
    checkConfirm() &&
    document.getElementById("term1").checked &&
    document.getElementById("term2").checked;

  btn.disabled = !ready;
  btn.classList.toggle("active", ready);
}

/* ===== ì´ë²¤íŠ¸ ë“±ë¡ ===== */
email.addEventListener("input", () => {
  checkEmail();
  updateButton();
});

password.addEventListener("input", () => {
  checkPassword();
  checkConfirm();  
  updateButton();
});

/* ğŸ”¥ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥: ì²« ê¸€ìë¶€í„° ë°˜ì‘ (IME ë¬¸ì œ í•´ê²°ë²„ì „) */
confirmPw.addEventListener("keydown", () => {
  setTimeout(() => {
    checkConfirm();
    updateButton();
  }, 0);
});

/* ì•½ê´€ ì²´í¬ë°•ìŠ¤ */
document.querySelectorAll(".term").forEach(cb =>
  cb.addEventListener("change", updateButton)
);

document.getElementById("agreeAll").addEventListener("change", e => {
  document.querySelectorAll(".term").forEach(cb => (cb.checked = e.target.checked));
  updateButton();
});

/* ===== ì œì¶œ ===== */
document.getElementById("signupForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!(checkEmail() && checkPassword() && checkConfirm())) return;

  try {
    const res = await fetch("https://blueon.up.railway.app/signup", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    email: email.value.trim(),
    password: password.value.trim(),
    phone: phoneInput.value.trim()
  })
});


    if (res.status === 409) {
      showErrorModal("ì´ë©”ì¼ ì¤‘ë³µ", "ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
      return;
    }

    let data = {};
    try {
      data = await res.json();
    } catch (err) { }

    if (!res.ok || data.success === false) {
      showErrorModal("íšŒì›ê°€ì… ì‹¤íŒ¨", data.message || "ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      return;
    }

    successModal.classList.add("active");
    setTimeout(() => {
      window.location.href = "login.html";
    }, 2000);

  } catch (err) {
    console.error(err);
    showErrorModal("ì„œë²„ ì˜¤ë¥˜", "ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }
});
function validatePhone() {
  const value = phoneInput.value.trim();
  const valid = /^01[0-9]{8,9}$/.test(value);

  if (!valid) {
    phoneError.style.display = "block";
  } else {
    phoneError.style.display = "none";
  }

  return valid;
}
function updateSignupButton() {
  const isEmailValid = emailError.style.display === "none";
  const isPwValid = passwordError.style.display === "none";
  const isConfirmValid = confirmError.style.display === "none";
  const isPhoneValid = phoneError.style.display === "none";

  const allTermsChecked = 
    term1.checked && term2.checked && term3.checked;

  if (isEmailValid && isPwValid && isConfirmValid && isPhoneValid && allTermsChecked) {
    signupBtn.disabled = false;
  } else {
    signupBtn.disabled = true;
  }
}
phoneInput.addEventListener("input", () => {
  validatePhone();
  updateSignupButton();
});

</script>

</body>
</html>
